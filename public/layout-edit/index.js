!function(){"use strict";const t=t=>0===(t=String(t)).length?"":t.replace(/[&<>'"]/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"}[t]))),e=(t,...e)=>{if(0===(t=String(t)).length)return"";return((t,e,...n)=>{let a=(t,e)=>(e.forEach(((e,n)=>{t=t.replace("%"+(n+1)+"$",e)})),t);return void 0===window.i18n||void 0===window.i18n.state.locale.values[t]?a(t,n):a(e(window.i18n.state.locale.values[t]),n)})(t,(t=>t.replace(/[&<>'"]/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"}[t])))),...e)},n=()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")},a=()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")},i=t=>{let e=new URLSearchParams(window.location.search),n=e.get("sid")?e.get("sid"):"",a=-1==t.indexOf("?")?"?sid="+n:"&sid="+n;return t+a},o=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},r=t=>{let e=t+"=",n=decodeURIComponent(document.cookie).split(";");for(let t=0;t<n.length;t++){let a=n[t];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""},s=()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+o()+"/"+r("locale");return e!=r("check")&&(t=0,console.log("refresh")),((t,e,n)=>{let a="";if(n){let t=new Date;t.setTime(t.getTime()+24*n*60*60*1e3),a=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+a+";path=/;domain=.kenzap.cloud"})("check",e,5),t},c=()=>({Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r("kenzap_api_key"),"Kenzap-Locale":r("locale")?r("locale"):"en","Kenzap-Header":s(),"Kenzap-Token":r("kenzap_token"),"Kenzap-Sid":o()});r("kenzap_api_key"),r("locale")&&r("locale"),s(),r("kenzap_token"),o();const d=t=>{if(console.log(t),isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let n=new URLSearchParams;return n.append("cmd","report"),n.append("sid",o()),n.append("token",r("kenzap_token")),n.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:n}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(t.reason)};function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,x(a.key),a)}}function p(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function g(t,e,n){return(e=x(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return v(t)}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=f(t);if(e){var i=f(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return b(this,n)}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function w(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function x(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var S=p((function t(e){var n,a;l(this,t),g(this,"CLASS_NAMES",{SELECTED:"selected",WITH_HREF:"with_href"}),g(this,"getOffset",(function(t){var e=t.getBoundingClientRect();return{x:Math.round(e.left+window.pageXOffset),y:Math.round(e.top+window.pageYOffset)}})),g(this,"getRightCoords",(function(t,e){return{x:t-app.getOffset("x"),y:e-app.getOffset("y")}})),g(this,"getOffset",(function(t){switch(t){case"x":case"y":return state.offset[t]}})),g(this,"id",(function(t){return document.getElementById(t)})),g(this,"hide",(function(t){return t.style.display="none",this})),g(this,"show",(function(t){return t.style.display="block",this})),g(this,"encode",(function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")})),g(this,"foreach",(function(t,e){for(var n=0,a=t.length;n<a;n++)e(t[n],n)})),g(this,"foreachReverse",(function(t,e){for(var n=t.length-1;n>=0;n--)e(t[n],n)})),g(this,"debug",(n=document.getElementById("debug"),function(){n.innerHTML=[].join.call(arguments," ")})),g(this,"stopEvent",(function(t){return t.stopPropagation(),t.preventDefault(),this})),g(this,"getUrlParameter",(function(t){var e,n,a=window.location.search.substring(1).split("&");for(n=0;n<a.length;n++)if((e=a[n].split("="))[0]===t)return void 0===e[1]||decodeURIComponent(e[1])})),g(this,"getCookie",(function(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var i=n[a];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return unescape(i.substring(e.length,i.length))}return""})),g(this,"extend",(function(t,e){var n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]=e[a]?e[a]:t[a]);return n})),g(this,"genID",(function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return e})),g(this,"inherits",(a=function(){},function(t,e){a.prototype=e.prototype,t.prototype=new a,t.prototype.constructor=t})),this._app=e})),A=p((function t(e,n,a,i,o){if(l(this,t),g(this,"ABSTRACT_METHOD",(function(){throw new Error("This is abstract method")})),g(this,"redraw",(function(t){return this.setSVGCoords(t||this._coords),this})),g(this,"remove",(function(){this._app.removeNodeFromSvg(this._groupEl)})),g(this,"move",(function(t,e){return this.setCoords(this.edit("move",t,e)).redraw(),this})),g(this,"rotate",(function(t,e){return this.setCoords(this.edit("move",t,e)).redraw(),this})),g(this,"newID",(function(){return this._attributes.id=this.utils.genID(6),this.redraw(),this})),g(this,"select",(function(){return this._el.classList.add(t.CLASS_NAMES.SELECTED),this})),g(this,"deselect",(function(){return this._el.classList.remove(t.CLASS_NAMES.SELECTED),this})),g(this,"setStyleOfElementWithHref",(function(){return this._el.classList.add(t.CLASS_NAMES.WITH_HREF),this})),g(this,"unsetStyleOfElementWithHref",(function(){return this._el.classList.remove(t.CLASS_NAMES.WITH_HREF),this})),g(this,"setInfoAttributes",(function(t){this._attributes.id=t.id,this._attributes.href=t.href,this._attributes.alt=t.alt,this._attributes.title=t.title})),g(this,"toJSON",(function(){return{type:this._type,title:this._title,seats:this._seats,coords:this._coords,attributes:this._attributes}})),g(this,"createAreasFromHTMLOfMap",(function(e){if(!e)return!1;for(;;){var n=t.REGEXP.AREA.exec(e);if(!n)break;var a=n[0],i=n[1],o=n[2].split(t.REGEXP.DELIMETER),r={};t.ATTRIBUTES_NAMES.forEach((function(e,n){var i=t.REGEXP[e].exec(a);i&&(r[name]=i[1])})),o=o.map((function(t){return Number(t)})),i=t.HTML_NAMES_TO_AREA_NAMES[i],t.fromJSON(this._app,{type:i,coords:t.CONSTRUCTORS[i].getCoordsFromHTMLArray(o),seats:seats,attributes:r})}return Boolean(a)})),this.constructor===t)throw new Error("This is abstract class");this.utils=new S(n),t.CONSTRUCTORS[e]=this,this._type=e,this._app=n,this._seats=i,this._attributes={id:this.utils.genID(6),href:"",points:[]},this._groupEl=document.createElementNS(t.SVG_NS,"g"),o?(this.setInfoAttributes(o),this._groupEl.dataset.id=o.id):(this.setInfoAttributes(this._attributes),this._groupEl.dataset.id=this._attributes.id),this._coords=a,this._app.addNodeToSvg(this._groupEl),this._groupEl.obj=this,this._el=null,this._helpers={},this._app.addObject(this)}));g(A,"SVG_NS","http://www.w3.org/2000/svg"),g(A,"CLASS_NAMES",{SELECTED:"selected",WITH_HREF:"with_href"}),g(A,"CONSTRUCTORS",{}),g(A,"REGEXP",{AREA:/<area(?=.*? shape="(rect|circle|poly)")(?=.*? coords="([\d ,]+?)")[\s\S]*?>/gim,HREF:/ href="([\S\s]+?)"/,ALT:/ alt="([\S\s]+?)"/,TITLE:/ title="([\S\s]+?)"/,DELIMETER:/ ?, ?/}),g(A,"HTML_NAMES_TO_AREA_NAMES",{rect:"rectangle",circle:"circle",poly:"polygon"}),g(A,"ATTRIBUTES_NAMES",["ID","HREF","ALT","TITLE"]),g(A,"fromJSON",(function(t,e){return t.fromJSONArea(e)})),g(A,"genID",(function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}));var E=p((function t(e,n,a,i){l(this,t),g(this,"setCoords",(function(e,n){return this._el.setAttribute("x",e+t.OFFSET),this._el.setAttribute("y",n+t.OFFSET),this})),g(this,"setId",(function(t){return this._el.n=t,this})),this._el=document.createElementNS(A.SVG_NS,"rect"),this._el.classList.add(t.CLASS_NAME),this._el.setAttribute("height",t.SIZE),this._el.setAttribute("width",t.SIZE),this._el.setAttribute("x",n+t.OFFSET),this._el.setAttribute("y",a+t.OFFSET),e.appendChild(this._el),this._el.action=i,this._el.classList.add(t.ACTIONS_TO_CURSORS[i])}));g(E,"SIZE",6),g(E,"OFFSET",-Math.ceil(E.SIZE/2)),g(E,"CLASS_NAME","helper"),g(E,"ACTIONS_TO_CURSORS",{move:"move",editLeft:"e-resize",editRight:"w-resize",editTop:"n-resize",editBottom:"s-resize",editTopLeft:"nw-resize",editTopRight:"ne-resize",editBottomLeft:"sw-resize",editBottomRight:"se-resize",movePoint:"pointer"});var k=function(t){h(n,t);var e=y(n);function n(t,a,i,o){var r;l(this,n),g(v(r=e.call(this,"rectangle",t,a,i,o)),"setSVGCoords",(function(t){this._el.setAttribute("x",t.x),this._el.setAttribute("y",t.y),this._el.setAttribute("width",t.width),this._el.setAttribute("height",t.height);var e=t.y,n=t.y+t.height/2,a=t.y+t.height,i=t.x,o=t.x+t.width/2,r=t.x+t.width;return this._helpers.center.setCoords(o,n),this._helpers.top.setCoords(o,e),this._helpers.bottom.setCoords(o,a),this._helpers.left.setCoords(i,n),this._helpers.right.setCoords(r,n),this._helpers.topLeft.setCoords(i,e),this._helpers.topRight.setCoords(r,e),this._helpers.bottomLeft.setCoords(i,a),this._helpers.bottomRight.setCoords(r,a),this})),g(v(r),"setCoords",(function(t){return this._coords.x=t.x,this._coords.y=t.y,this._coords.width=t.width,this._coords.height=t.height,this})),g(v(r),"dynamicDraw",(function(t,e,n){var a={x:this._coords.x,y:this._coords.y,width:t-this._coords.x,height:e-this._coords.y};return n&&(a=this.getSquareCoords(a)),a=this.getNormalizedCoords(a),this.redraw(a),a})),g(v(r),"onProcessDrawing",(function(t){var e=utils.getRightCoords(t.pageX,t.pageY);this.dynamicDraw(e.x,e.y,t.shiftKey)})),g(v(r),"onStopDrawing",(function(t){var e=utils.getRightCoords(t.pageX,t.pageY);this.setCoords(this.dynamicDraw(e.x,e.y,t.shiftKey)).deselect(),app.removeAllEvents().setIsDraw(!1).resetNewArea()})),g(v(r),"edit",(function(t,e,n){var a=Object.create(this._coords);switch(t){case"move":a.x+=e,a.y+=n;break;case"editLeft":a.x+=e,a.width-=e;break;case"editRight":a.width+=e;break;case"editTop":a.y+=n,a.height-=n;break;case"editBottom":a.height+=n;break;case"editTopLeft":a.x+=e,a.y+=n,a.width-=e,a.height-=n;break;case"editTopRight":a.y+=n,a.width+=e,a.height-=n;break;case"editBottomLeft":a.x+=e,a.width-=e,a.height+=n;break;case"editBottomRight":a.width+=e,a.height+=n}return a})),g(v(r),"dynamicEdit",(function(t,e){return t=this.getNormalizedCoords(t),e&&(t=this.getSavedProportionsCoords(t)),this.redraw(t),t})),g(v(r),"onProcessEditing",(function(t){return this.dynamicEdit(this.edit(app.getEditType(),t.pageX-this.editingStartPoint.x,t.pageY-this.editingStartPoint.y),t.shiftKey)})),g(v(r),"onStopEditing",(function(t){this.setCoords(this.onProcessEditing(t)),app.removeAllEvents()})),g(v(r),"toString",(function(){return"Rectangle {x: "+this._coords.x+", y: "+this._coords.y+", width: "+this._coords.width+", height: "+this._coords.height+"}"})),g(v(r),"toHTMLMapElementString",(function(){var t=this._coords.x+this._coords.width,e=this._coords.y+this._coords.height;return'<area shape="rect" coords="'+this._coords.x+", "+this._coords.y+", "+t+", "+e+'"'+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"})),g(v(r),"getCoordsForDisplayingInfo",(function(){return{x:this._coords.x,y:this._coords.y}})),g(v(r),"testCoords",(function(t){return t.x&&t.y&&t.width&&t.height})),g(v(r),"testHTMLCoords",(function(t){return 4===t.length})),g(v(r),"getCoordsFromHTMLArray",(function(t){if(!this.testHTMLCoords(t))throw new Error("This html-coordinates is not valid for rectangle");return{x:t[0],y:t[1],width:t[2]-t[0],height:t[3]-t[1]}})),g(v(r),"getNormalizedCoords",(function(t){return t.width<0&&(t.x+=t.width,t.width=Math.abs(t.width)),t.height<0&&(t.y+=t.height,t.height=Math.abs(t.height)),t})),g(v(r),"getSquareCoords",(function(t){var e=Math.abs(t.width),n=Math.abs(t.height);return e>n?t.width=t.width>0?n:-n:t.height=t.height>0?e:-e,t})),g(v(r),"getSavedProportionsCoords",(function(t,e){var n=t.width/t.height;return e.width/e.height>n?t.width=Math.round(t.height*n):t.height=Math.round(t.width/n),t})),g(v(r),"createAndStartDrawing",(function(t){var e=new n({x:t.x,y:t.y,width:0,height:0});return app.addEvent(app.domElements.container,"mousemove",e.onProcessDrawing.bind(e)).addEvent(app.domElements.container,"click",e.onStopDrawing.bind(e)),e})),r.app=t,r._coords={x:a.x||0,y:a.y||0,width:a.width||0,height:a.height||0},r._el=document.createElementNS(A.SVG_NS,"rect"),r._groupEl.appendChild(r._el);var s=a.x-r._coords.width/2,c=a.y-r._coords.height/2;return r._helpers={center:new E(r._groupEl,s,c,"move"),top:new E(r._groupEl,s,c,"editTop"),bottom:new E(r._groupEl,s,c,"editBottom"),left:new E(r._groupEl,s,c,"editLeft"),right:new E(r._groupEl,s,c,"editRight"),topLeft:new E(r._groupEl,s,c,"editTopLeft"),topRight:new E(r._groupEl,s,c,"editTopRight"),bottomLeft:new E(r._groupEl,s,c,"editBottomLeft"),bottomRight:new E(r._groupEl,s,c,"editBottomRight")},r.redraw(),r}return p(n)}(A);function C(t,e){return e.map((e=>function(t,e){return Array.isArray(e)?[t.a*e[0]+t.c*e[1]+t.e,t.b*e[0]+t.d*e[1]+t.f]:{x:t.a*e.x+t.c*e.y+t.e,y:t.b*e.x+t.d*e.y+t.f}}(t,e)))}function L(t){return void 0===t}function T(t,e=0){return{a:1,c:0,e:t,b:0,d:1,f:e}}function O(...t){const e=(t,e)=>({a:t.a*e.a+t.c*e.b,c:t.a*e.c+t.c*e.d,e:t.a*e.e+t.c*e.f+t.e,b:t.b*e.a+t.d*e.b,d:t.b*e.c+t.d*e.d,f:t.b*e.e+t.d*e.f+t.f});switch((t=Array.isArray(t[0])?t[0]:t).length){case 0:throw new Error("no matrices provided");case 1:return t[0];case 2:return e(t[0],t[1]);default:{const[n,a,...i]=t;return O(e(n,a),...i)}}}function M(...t){return O(...t)}const{cos:N,sin:D,PI:P}=Math;function z(t,e,n){return function(t,e,n){const a=N(t),i=D(t),o={a:a,c:-i,e:0,b:i,d:a,f:0};return L(e)||L(n)?o:O([T(e,n),o,T(-e,-n)])}(t*P/180,e,n)}function I(t,e,n,a){var i=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(i,I.prototype),i.expected=e,i.found=n,i.location=a,i.name="SyntaxError",i}function j(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,t+(n+=n.repeat(e)).slice(0,e))}!function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(I,Error),I.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n,a=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){a=t[n].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,o=this.location.source+":"+i.line+":"+i.column;if(a){var r=this.location.end,s=j("",i.line.toString().length," "),c=a[i.line-1],d=(i.line===r.line?r.column:c.length+1)-i.column||1;e+="\n --\x3e "+o+"\n"+s+" |\n"+i.line+" | "+c+"\n"+s+" | "+j("",i.column-1," ")+j("",d,"^")}else e+="\n at "+o}return e},I.buildMessage=function(t,e){var n={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function a(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+a(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+a(t)}))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+a(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+a(t)}))}function r(t){return n[t.type](t)}return"Expected "+function(t){var e,n,a=t.map(r);if(a.sort(),a.length>0){for(e=1,n=1;e<a.length;e++)a[e-1]!==a[e]&&(a[n]=a[e],n++);a.length=n}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(e)+" found."};var R=function(t){h(n,t);var e=y(n);function n(t,a,i,o){var r;l(this,n),g(v(r=e.call(this,"polygon",t,a,i,o)),"close",(function(){var t=r._el;r._el=document.createElementNS(A.SVG_NS,"polygon"),r._groupEl.replaceChild(r._el,t),r._coords.isOpened=!1,r.redraw().deselect()})),g(v(r),"setSVGCoords",(function(t){var e=t.points.reduce((function(t,e){return t+e.x+" "+e.y+" "}),"");return r._el.setAttribute("points",e),r.foreach(r._helpers.points,(function(e,n){e.setCoords(t.points[n].x,t.points[n].y)})),v(r)})),g(v(r),"foreach",(function(t,e){for(var n=0,a=t.length;n<a;n++)e(t[n],n)})),g(v(r),"getRightCoords",(function(t,e,n){return{x:e-t.getOffset("x"),y:n-t.getOffset("y")}})),g(v(r),"setCoords",(function(t){return r._coords.points=t.points,v(r)})),g(v(r),"addPoint",(function(t,e){if(!r._coords.isOpened)throw new Error("This polygon is closed!");var n=new E(r._groupEl,t,e,"movePoint");return n.setId(r._helpers.points.length),r._helpers.points.push(n),r._coords.points.push({x:t,y:e}),r.redraw(),v(r)})),g(v(r),"dynamicDraw",(function(t,e,a,i){var o={points:[].concat(r._coords.points)};if(i){var s=n.getRightAngleLineLastPointCoords(r._coords,{x:e,y:a});e=s.x,a=s.y}return o.points.push({x:e,y:a}),r.redraw(o),o})),g(v(r),"onProcessDrawing",(function(t){var e=r.getRightCoords(r.app,t.pageX,t.pageY);r.dynamicDraw(r.app,e.x,e.y,t.shiftKey)})),g(v(r),"onAddPointDrawing",(function(t){var e=r.getRightCoords(r.app,t.pageX,t.pageY);t.shiftKey&&(e=n.getRightAngleLineLastPointCoords(r._coords,e)),r.addPoint(e.x,e.y)})),g(v(r),"onStopDrawing",(function(t){var e=r.app;("click"==t.type||"keydown"==t.type&&13==t.keyCode)&&r.testCoords(r._coords)&&(r.close(),e.removeAllEvents().setIsDraw(!1).resetNewArea()),t.stopPropagation()})),g(v(r),"edit",(function(t,e,n){var a=Object.create(r._coords);switch(t){case"move":for(var i=0,o=a.points.length;i<o;i++)a.points[i].x+=e,a.points[i].y+=n;break;case"movePoint":a.points[r.selected_point].x+=e,a.points[r.selected_point].y+=n}return a})),g(v(r),"onProcessEditing",(function(t){var e=r.app.getEditType();r.redraw(r.edit(e,t.pageX-r.editingStartPoint.x,t.pageY-r.editingStartPoint.y)),r.editingStartPoint.x=t.pageX,r.editingStartPoint.y=t.pageY})),g(v(r),"onStopEditing",(function(t){var e=r.app.getEditType();r.setCoords(r.edit(e,t.pageX-r.editingStartPoint.x,t.pageY-r.editingStartPoint.y)).redraw(),r.app.removeAllEvents()})),g(v(r),"toString",(function(){return"Polygon {points: ["+r._coords.points.map((function(t){return"["+t.x+", "+t.y+"]"})).join(", ")+"]}"})),g(v(r),"toHTMLMapElementString",(function(){return'<area shape="poly" coords="'+r._coords.points.map((function(t){return t.x+", "+t.y})).join(", ")+'"'+(r._attributes.id?' href="'+r._attributes.id+'"':"")+(r._attributes.href?' href="'+r._attributes.href+'"':"")+(r._attributes.alt?' alt="'+r._attributes.alt+'"':"")+(r._attributes.title?' title="'+r._attributes.title+'"':"")+" />"})),g(v(r),"getCoordsForDisplayingInfo",(function(){return{x:r._coords.points[0].x,y:r._coords.points[0].y}})),g(v(r),"testCoords",(function(t){return t.points.length>=3})),g(v(r),"testHTMLCoords",(function(t){return t.length>=6&&t.length%2==0})),g(v(r),"getCoordsFromHTMLArray",(function(t){if(!testHTMLCoords(t))throw new Error("This html-coordinates is not valid for polygon");for(var e=[],n=0,a=t.length/2;n<a;n++)e.push({x:t[2*n],y:t[2*n+1]});return{points:e}})),g(v(r),"getRightAngleLineLastPointCoords",(function(t,e){var n=.414,a=2.414,i=t.points.length-1,o=t.points[i],r=e.x-o.x,s=-(e.y-o.y),c=s/r,d=e.x,l=e.y;return r>0&&s>0?c>a?d=o.x:c<n?l=o.y:Math.abs(r)>Math.abs(s)?d=o.x+s:l=o.y-r:r<0&&s>0?c<-a?d=o.x:c>-n?l=o.y:Math.abs(r)>Math.abs(s)?d=o.x-s:l=o.y+r:r<0&&s<0?c>a?d=o.x:c<n?l=o.y:Math.abs(r)>Math.abs(s)?d=o.x+s:l=o.y-r:r>0&&s<0&&(c<-a?d=o.x:c>-n?l=o.y:Math.abs(r)>Math.abs(s)?d=o.x-s:l=o.y+r),{x:d,y:l}})),g(v(r),"copy",(function(t,e){var n=r.app,a=JSON.parse(t.toJSON());n.foreach(a.areas,(function(t){if(t.attributes.id==e._attributes.id){var a=t.coords;return n.foreach(t.coords.points,(function(t,e){a.points[e].x+=10,a.points[e].y+=10})),t.coords=a,t.attributes.id=A.genID(6),A.fromJSON(n,t)}}))})),g(v(r),"getCenterPoint",(function(t){var e,n,a,i;return t.map((function(t){void 0===e&&(e=t.x),void 0===n&&(n=t.x),void 0===a&&(a=t.y),void 0===i&&(i=t.y),t.x>n&&(n=t.x),t.x<e&&(e=t.x),t.y>i&&(i=t.y),t.y<a&&(a=t.y)})),{x:(n+e)/2,y:(i+a)/2}})),g(v(r),"rotate",(function(t,e){var n=r.getCenterPoint(t._coords.points),a=M(z(e)),i=C(a,t._coords.points),o=r.getCenterPoint(i);if(i=C(M(T(n.x-o.x,n.y-o.y)),i),console.log(t._seats.points),void 0!==t._seats&&void 0!==t._seats.points)try{var s=C(a,t._seats.points);t._seats.points=s,t._coords.points=i,r.redraw()}catch(t){var c=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML="Please allocate all seats inside this zone to make rotation.",c.show()}else t._coords.points=i,r.redraw();return t})),r.app=t,r._coords={points:a.points||[{x:0,y:0}],isOpened:a.isOpened||!1},r._el=document.createElementNS(A.SVG_NS,r._coords.isOpened?"polyline":"polygon"),void 0!==o&&(r._el.dataset.id=o.id),void 0===i&&(i=[]),r._groupEl.appendChild(r._el),r._helpers={points:[]};for(var s=0,c=r._coords.points.length;s<c;s++)r._helpers.points.push(new E(r._groupEl,r._coords.points[s].x,r._coords.points[s].y,"movePoint").setId(s));return r._selectedPoint=-1,r.redraw(),r}return p(n)}(A);g(R,"createAndStartDrawing",(function(t,e){var n=new R(t,{title:"",points:[e],isOpened:!0});return t.addEvent(t.domElements.container,"mousemove",n.onProcessDrawing.bind(n)).addEvent(t.domElements.container,"click",n.onAddPointDrawing.bind(n)).addEvent(document,"keydown",n.onStopDrawing.bind(n)).addEvent(n._helpers.points[0]._el,"click",n.onStopDrawing.bind(n)),n}));var H=function(t){h(n,t);var e=y(n);function n(t,a,i,o){var r;return l(this,n),g(v(r=e.call(this,"circle",t,a,i,o)),"setSVGCoords",(function(t){return this._el.setAttribute("cx",t.cx),this._el.setAttribute("cy",t.cy),this._el.setAttribute("r",t.radius),this._el.setAttribute("p",""),this.helpers.center.setCoords(t.cx,t.cy),this.helpers.top.setCoords(t.cx,t.cy-t.radius),this.helpers.right.setCoords(t.cx+t.radius,t.cy),this.helpers.bottom.setCoords(t.cx,t.cy+t.radius),this.helpers.left.setCoords(t.cx-t.radius,t.cy),this})),g(v(r),"setCoords",(function(t){return this._coords.cx=t.cx,this._coords.cy=t.cy,this._coords.radius=t.radius,this})),g(v(r),"dynamicDraw",(function(t,e){var n=Math.round(Math.sqrt(Math.pow(this._coords.cx-t,2)+Math.pow(this._coords.cy-e,2))),a={cx:this._coords.cx,cy:this._coords.cy,radius:n};return this.redraw(a),a})),g(v(r),"onProcessDrawing",(function(t){var e=utils.getRightCoords(t.pageX,t.pageY);this.dynamicDraw(e.x,e.y)})),g(v(r),"onStopDrawing",(function(t){var e=utils.getRightCoords(t.pageX,t.pageY);this.setCoords(this.dynamicDraw(e.x,e.y)).deselect(),app.removeAllEvents().setIsDraw(!1).resetNewArea()})),g(v(r),"edit",(function(t,e,n){var a=Object.create(this._coords);switch(t){case"move":a.cx+=e,a.cy+=n;break;case"editTop":a.radius-=n;break;case"editBottom":a.radius+=n;break;case"editLeft":a.radius-=e;break;case"editRight":a.radius+=e}return a})),g(v(r),"dynamicEdit",(function(t){return t.radius<0&&(t.radius=Math.abs(t.radius)),this.setSVGCoords(t),t})),g(v(r),"onProcessEditing",(function(t){var e=app.getEditType();return this.dynamicEdit(this.edit(e,t.pageX-this.editingStartPoint.x,t.pageY-this.editingStartPoint.y))})),g(v(r),"onStopEditing",(function(t){app.getEditType(),this.setCoords(this.onProcessEditing(t)),app.removeAllEvents()})),g(v(r),"toString",(function(){return"Circle {cx: "+this._coords.cx+", cy: "+this._coords.cy+", radius: "+this._coords.radius+"}"})),g(v(r),"toHTMLMapElementString",(function(){return'<area shape="circle" coords="'+this._coords.cx+", "+this._coords.cy+", "+this._coords.radius+'"'+(this._attributes.id?' href="'+this._attributes.id+'"':"")+(this._attributes.href?' href="'+this._attributes.href+'"':"")+(this._attributes.alt?' alt="'+this._attributes.alt+'"':"")+(this._attributes.title?' title="'+this._attributes.title+'"':"")+" />"})),g(v(r),"getCoordsForDisplayingInfo",(function(){return{x:this._coords.cx,y:this._coords.cy}})),g(v(r),"testCoords",(function(t){return t.cx&&t.cy&&t.radius})),g(v(r),"testHTMLCoords",(function(t){return 3===t.length})),g(v(r),"getCoordsFromHTMLArray",(function(t){if(!this.testHTMLCoords(t))throw new Error("This html-coordinates is not valid for circle");return{cx:t[0],cy:t[1],radius:t[2]}})),g(v(r),"createAndStartDrawing",(function(t){var e=new n({cx:t.x,cy:t.y,radius:0});return app.addEvent(app.domElements.container,"mousemove",e.onProcessDrawing.bind(e)).addEvent(app.domElements.container,"click",e.onStopDrawing.bind(e)),e})),r.app=t,r._coords={cx:a.cx||0,cy:a.cy||0,radius:a.radius||0},void 0===i&&(i=[]),r._el=document.createElementNS(A.SVG_NS,"circle"),r._groupEl.appendChild(r._el),r.helpers={center:new E(r._groupEl,a.cx,a.cy,"move"),top:new E(r._groupEl,a.cx,a.cy,"editTop"),bottom:new E(r._groupEl,a.cx,a.cy,"editBottom"),left:new E(r._groupEl,a.cx,a.cy,"editLeft"),right:new E(r._groupEl,a.cx,a.cy,"editRight")},r.redraw(),r}return p(n)}(A),F=p((function n(a,i,o){l(this,n),g(this,"drawStats",(function(){var n=this,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this._areas,o='<table class="table" style="width:100%;min-width:700px;">';o+="<tr><th></th><th>".concat(e("Zone"),"</th>"),this._cfs.map((function(t){o+="<th>".concat(t.label,"</th>")})),o+="<th>".concat(e("Seat Count"),"</th></tr>");var r={seatsPerZone:0,totalZones:0,totalSeats:0,totalTws:0,i:1},s=3+this._cfs.length,c=function(t){if(r.seatsPerZone=0,void 0!==i[t]._seats){for(var e in i[t]._seats.points)null!=i[t]._seats.points[e]&&1==i[t]._seats.points[e].i&&(r.seatsPerZone+=1);var a=i[t]._seats.tws?parseInt(i[t]._seats.tws):0,c=i[t]._seats.title?i[t]._seats.title:"";r.totalZones+=1,r.totalSeats+=r.seatsPerZone,r.totalTws+=a,o+="<tr><td>"+r.i+"</td><td>"+c+"</td>",n._cfs.map((function(e){o+="<td>".concat(i[t]._seats[e.id]?i[t]._seats[e.id]:"","</td>")})),o+="<td>"+r.seatsPerZone+"/"+a+"</td></tr>"}else o+='<tr><td colspan="'+s+'">'+r.i+"</td></tr>";r.i++};for(var d in i)c(d);if(o+='<tr><td colspan="'.concat(t(s),'">').concat(e("Total zones: $1%",r.totalZones),"</td></tr>"),o+='<tr><td colspan="'.concat(t(s),'">').concat(e("Total seats in all zones: $1%",r.totalTws),"</td></tr>"),o+='<tr><td colspan="'.concat(t(s),'">').concat(e("Total seats available for booking: $1%",r.totalSeats),"</td></tr>"),o+="</table>",!a)return delete r.i,r;this._el.setAttribute("style","overflow-x: scroll;"),this._el.innerHTML=o})),g(this,"getStats",(function(){return this.drawStats(!1)})),this._el=a,this._areas=i,this._cfs=o})),X=function(){var t,i,s={SVG_NS:"http://www.w3.org/2000/svg",CLASS_NAMES:{SELECTED:"selected",WITH_HREF:"with_href"},getOffset:function(t){var e=t.getBoundingClientRect();return{x:Math.round(e.left+window.pageXOffset),y:Math.round(e.top+window.pageYOffset)}},getRightCoords:function(t,e){return{x:t-l.getOffset("x"),y:e-l.getOffset("y")}},id:function(t){return document.getElementById(t)},hide:function(t){return t.style.display="none",this},show:function(t){return t.style.display="block",this},encode:function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")},foreach:function(t,e){for(var n=0,a=t.length;n<a;n++)e(t[n],n)},foreachReverse:function(t,e){for(var n=t.length-1;n>=0;n--)e(t[n],n)},debug:(i=document.getElementById("debug"),function(){i.innerHTML=[].join.call(arguments," ")}),stopEvent:function(t){return t.stopPropagation(),t.preventDefault(),this},getUrlParameter:function(t){var e,n,a=window.location.search.substring(1).split("&");for(n=0;n<a.length;n++)if((e=a[n].split("="))[0]===t)return void 0===e[1]||decodeURIComponent(e[1])},getCookie:function(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var i=n[a];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return unescape(i.substring(e.length,i.length))}return""},extend:function(t,e){var n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]=e[a]?e[a]:t[a]);return n},genID:function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},inherits:(t=function(){},function(e,n){t.prototype=n.prototype,e.prototype=new t,e.prototype.constructor=e})},l=function(){var t={wrapper:s.id("wrapper"),svg:s.id("svg"),img:s.id("img"),container:s.id("image"),seat_mapping:s.id("svg_mapping_cont"),map:null},i={CONSTRUCTORS:{rectangle:k,circle:H,polygon:R},offset:{x:0,y:0},cp:{x:0,y:0},clickTime:(new Date).getTime(),svg_width:0,svg_height:0,max_times:1,appMode:null,currentType:null,editType:null,newArea:null,selectedArea:null,mappingArea:null,cfs:[],pcfs:[],cfs_listener:null,areas:[],events:[],isDraw:!1,silent:!1,image:{src:null,filename:null,width:0,height:0},last_scroll:0,to:"",moved:!1,mapping:!1,autoAssign:!1,autoAssignRT:[],autoAssignRow:!1,autoAssignDone:[],autoAlign:!1,autoAlignXY:[],autoDraw:{points:[],count:"",active:!1},updateObjectSeatPointsHistory:[],timer1:null,timer2:null},p=112,g=27,v=38,b=40,y=37,_=39,x=46,S=8,A=81,E=69,C=65,L=68,T=72,O=83,M=67,N=74,D=85,P=90;function z(){i.to&&window.clearTimeout(i.to),i.to=window.setTimeout((function(){i.offset=s.getOffset(t.container)}),100)}window.addEventListener("resize",z,!1),window.addEventListener("scroll",z,!1),t.container.addEventListener("mousedown",(function(t){t.preventDefault()}),!1),t.seat_mapping.addEventListener("mousedown",(function(t){t.preventDefault(),i.clickTime=(new Date).getTime()}),!1),t.img.addEventListener("dragstart",(function(t){t.preventDefault()}),!1);var I,j=(I=s.id("coords"),{set:function(t){I.innerHTML="x: "+t.x+", y: "+t.y},empty:function(){I.innerHTML=""}});function X(t){if("editing"===i.appMode)if("g"===t.target.parentNode.tagName)if(f.unload(),i.selectedArea=t.target.parentNode.obj,l.deselectAll(),i.selectedArea.select(),i.selectedArea.editingStartPoint={x:t.pageX,y:t.pageY},t.target.classList.contains("helper")){var e=t.target;i.editType=e.action,e.n>=0&&(i.selectedArea.selected_point=e.n),l.addEvent(l.domElements.container,"mousemove",i.selectedArea.onProcessEditing.bind(i.selectedArea)).addEvent(l.domElements.container,"mouseup",i.selectedArea.onStopEditing.bind(i.selectedArea))}else"rect"!==t.target.tagName&&"circle"!==t.target.tagName&&"polygon"!==t.target.tagName||(i.editType="move",l.addEvent(l.domElements.container,"mousemove",i.selectedArea.onProcessEditing.bind(i.selectedArea)).addEvent(l.domElements.container,"mouseup",i.selectedArea.onStopEditing.bind(i.selectedArea)));else l.deselectAll(),f.unload();else if("seating"===i.appMode){if("g"===t.target.parentNode.tagName){f.unload(),i.selectedArea=t.target.parentNode.obj,l.deselectAll(),i.selectedArea.select(),i.selectedArea.editingStartPoint={x:t.pageX,y:t.pageY};var o=t.target.parentNode.dataset.id;$("#kenzap_seat_map").attr("data-id",o),$("#zone_title").val(l.getObjectSeats(l.getSelectedArea(),"title")),$("#zone_tws").val(l.getObjectSeats(l.getSelectedArea(),"tws")),$("#zone_tns").val(l.getObjectSeats(l.getSelectedArea(),"tns")),$("#zone_price").val(l.getObjectSeats(l.getSelectedArea(),"price")),$("#zone_bgi").val(""),$("#zone_bg").attr("src","https://cdn.kenzap.com/loading.png"),$(".remove").css("display","none");var r=l.getObjectSeats(l.getSelectedArea(),"bg");void 0===r&&(r=""),r.length>12&&($("#zone_bgi").val(r),$("#zone_bg").attr("src",r),$(".remove").css("display","inline-block"),$(".remove").off(),$(".remove").on("click",(function(){if(confirm("Remove background image?")){$("#loader").fadeIn("fast");var t=new FormData,e=s.getUrlParameter("id")+"-"+o;t.append("id",e),t.append("cmd","remove_image"),t.append("type","myticket"),t.append("token",s.getCookie("kenzap_token")),$.ajax({url:"https://fileapi.kenzap.com/v1/",cmd:"remove_image",type:"post",data:t,contentType:!1,processData:!1,success:function(t){var e=t;e.success?($("#zone_bgi").val(""),$("#zone_bg").attr("src","https://cdn.kenzap.com/loading.png"),$("#loader").fadeOut("fast")):alert("Unable to save: "+e.reason)}})}}))),$("#zone_bg").off(),$(".bg-file").off(),$(".bg-file").val(null),$("#zone_bg").on("click",(function(){$(".bg-file").trigger("click")})),$(".bg-file").on("change",(function(t){var e=this;if(e.files&&e.files[0]){var i=e.files[0],r=new FormData,c=s.getUrlParameter("id")+"-"+o;r.append("file",i),r.append("id",c),r.append("cmd","store_image"),r.append("type","myticket"),r.append("token",s.getCookie("kenzap_token")),n(),$.ajax({url:"https://fileapi.kenzap.com/v1/",cmd:"store_image",type:"post",data:r,contentType:!1,processData:!1,success:function(t){var e=JSON.parse(t);e.success?setTimeout((function(){var t=new Date,e="https://cdn.kenzap.com/myticket/"+c+".jpeg?"+t.getTime();console.log("store_image zone bg "+e),document.querySelector("#zone_bg")&&(document.querySelector("#zone_bg").setAttribute("src",e),document.querySelector("#zone_bgi").value=e),l.updateObjectSeats(l.getSelectedArea(),"bg",e),a()}),5e3):alert("Unable to save: "+e.reason)}})}})),document.querySelector(".form-group-custom").innerHTML="",document.querySelector(".form-price-custom").innerHTML="",void 0===i.cfs&&(i.cfs=[]),void 0===i.pcfs&&(i.pcfs=[]),i.cfs.map((function(t){var e=l.structCustomField(t);document.querySelector(".form-group-custom").appendChild(e),$("#"+t.id).val(l.getObjectSeats(l.getSelectedArea(),t.id))})),$("#zone_price").fadeIn(0),i.pcfs.map((function(t){var e=l.structPriceField(t);document.querySelector(".form-price-custom").appendChild(e),$("#"+t.id).val(l.getObjectSeats(l.getSelectedArea(),t.id)),$("#zone_price").fadeOut(0)})),i.cfs_listener||document.querySelector("#zone_add_field").addEventListener("click",(function(t){var e,n=0,a=w(document.querySelectorAll(".form-group-custom .custom-field"));try{for(a.s();!(e=a.n()).done;){var o=e.value;parseInt(o.dataset.index)>n&&(n=parseInt(o.dataset.index))}}catch(t){a.e(t)}finally{a.f()}var r={id:"cf"+(n+=1),index:n,label:"Custom field",value:""},s=l.structCustomField(r);document.querySelector(".form-group-custom").appendChild(s),i.cfs.push(r),t.preventDefault()}),!1),i.cfs_listener||document.querySelector("#zone_add_price").addEventListener("click",(function(t){var e,n=0,a=w(document.querySelectorAll(".form-price-custom .custom-price-field"));try{for(a.s();!(e=a.n()).done;){var o=e.value;parseInt(o.dataset.index)>n&&(n=parseInt(o.dataset.index))}}catch(t){a.e(t)}finally{a.f()}var r={id:"pcf"+(n+=1),index:n,label:"Price variation",value:""},s=l.structPriceField(r);document.querySelector(".form-price-custom").appendChild(s),$("#zone_price").fadeOut(0),i.pcfs.push(r),t.preventDefault()}),!1),i.cfs_listener="attached";var c=document.querySelector("#kenzap_seat_map");new bootstrap.Modal(c).show()}}else if("mapping"===i.appMode)if("g"===t.target.parentNode.tagName){f.unload(),i.mappingArea=t.target.dataset.index,i.moved=!1,i.mapping=!0;var d=$("#cr"+i.mappingArea);d.offset(),$(".cr").removeClass("selected"),d.addClass("selected").removeClass("align"),i.autoAlign&&(d.addClass("align"),i.autoAlignXY||(i.autoAlignXY=[]),i.autoAlignXY.push({x:parseInt(d.attr("cx")),y:parseInt(d.attr("cy"))}),Y(i.autoAssignRow),i.autoAssignRow=!1),i.autoAlign=!1,l.deselectAll()}else l.deselectAll(),f.unload()}t.container.addEventListener("mousemove",(function(t){j.set(s.getRightCoords(t.pageX,t.pageY))}),!1),t.seat_mapping.addEventListener("mousemove",(function(t){var e=$("#svg_mapping").offset();(new Date).getTime()-i.clickTime<400||i.mapping&&(i.moved=!0,$("#cr"+i.mappingArea).attr("cx",t.pageX-e.left),$("#cr"+i.mappingArea).attr("cy",t.pageY-e.top),$("#tx"+i.mappingArea).attr("x",t.pageX-e.left),$("#tx"+i.mappingArea).attr("y",t.pageY-e.top))}),!1),t.seat_mapping.addEventListener("mouseup",(function(t){if("circle"===t.target.tagName||"text"===t.target.tagName){$("#seat_notice").fadeOut(0),$("#seat_row,#seat_text,#seat_price").fadeIn(100);var e=l.getSelectedArea(),n=t.target.parentNode.dataset.index,a=$("#svg_mapping").offset(),o=l.getObjectSeatPoints(e,n);o||(o={x:0,y:0,r:"",t:"",p:"",i:!1}),i.moved&&(o.x=(t.pageX-a.left-i.svg_width)/i.max_times,o.y=(t.pageY-a.top-i.svg_height)/i.max_times,$("#cr"+i.mappingArea).attr("cx",t.pageX-a.left),$("#cr"+i.mappingArea).attr("cy",t.pageY-a.top),$("#tx"+i.mappingArea).attr("x",t.pageX-a.left),$("#tx"+i.mappingArea).attr("y",t.pageY-a.top),l.updateObjectSeatPoints(e,n,o)),$("#seat_text_in").val($("#tx"+n).html()).data("index",n),o.p?$("#seat_price_in").val(o.p):$("#seat_price_in").val(l.getObjectSeats(l.getSelectedArea(),"price")),o.r?$("#seat_row_in").val(o.r):$("#seat_row_in").val(l.getObjectSeats(l.getSelectedArea(),"title")),i.moved=!1,i.mapping=!1}if("circle"!==t.target.tagName&&"text"!==t.target.tagName&&"g"!==t.target.tagName&&i.autoDraw.active){var r=$("#svg_mapping").offset();if(i.autoDraw.points.push({x:t.pageX-r.left,y:t.pageY-r.top}),2==i.autoDraw.points.length){var s=i.autoDraw.points[1].x-i.autoDraw.points[0].x,c=i.autoDraw.points[1].y>i.autoDraw.points[0].y?i.autoDraw.points[1].y-i.autoDraw.points[0].y:i.autoDraw.points[0].y-i.autoDraw.points[1].y,d=Math.sqrt(s*s+c*c),u=Math.atan(c/s);console.log(" x = "+s+" y = "+c+" c = "+d);for(var p,g=d/(parseInt(i.autoDraw.count)-1),h=g,f=0,m=i.autoDraw.points[0].x,v=i.autoDraw.points[0].y;f<parseInt(i.autoDraw.count);){console.log("new while");var b,y=w(document.querySelectorAll(".cr"));try{for(y.s();!(b=y.n()).done;){var _=b.value,x=void 0===_.getAttribute("data-inside")?"true":_.getAttribute("data-inside"),S=JSON.parse(x);if(p=parseInt(_.getAttribute("data-index")),!S){document.querySelector("#cr"+p).setAttribute("cx",m),document.querySelector("#cr"+p).setAttribute("cy",v),document.querySelector("#tx"+p).setAttribute("x",m),document.querySelector("#tx"+p).setAttribute("y",v),document.querySelector("#cr"+p).setAttribute("data-inside",S),document.querySelector("#tx"+p).setAttribute("data-inside",S),console.log(p+" "+S+" newX: "+m+" newY: "+v);break}}}catch(t){y.e(t)}finally{y.f()}if(void 0===p)return;i.mappingArea=p;var A=l.getSelectedArea(),E=l.getObjectSeatPoints(A,i.mappingArea);E||(E={x:0,y:0,r:"",t:"",p:"",i:!1}),E.x=(m-i.svg_width)/i.max_times,E.y=(v-i.svg_height)/i.max_times,l.updateObjectSeatPoints(A,i.mappingArea,E);var k=h*Math.cos(u),C=Math.sqrt(h*h-k*k);m=i.autoDraw.points[0].x+k,v=i.autoDraw.points[1].y>i.autoDraw.points[0].y?i.autoDraw.points[0].y+C:i.autoDraw.points[0].y-C,f++,h+=g}i.mapping=!1,i.autoDraw.active=!1,i.autoDraw.count="",i.autoDraw.points=[]}}}),!1),t.container.addEventListener("mouseleave",(function(){j.empty()}),!1),t.seat_mapping.addEventListener("mouseleave",(function(){j.empty()}),!1),t.container.addEventListener("mousedown",X,!1),t.seat_mapping.addEventListener("mousedown",X,!1),t.seat_mapping.addEventListener("mouseover",(function(t){if("g"===t.target.parentNode.tagName&&i.autoAssign){if(i.mappingArea=t.target.dataset.index,void 0===i.mappingArea)return;if(i.autoAssignDone.includes(i.mappingArea))return;var e=$("#cr"+i.mappingArea),n=$("#tx"+i.mappingArea);e.addClass("assign");var a=l.getSelectedArea(),o=l.getObjectSeatPoints(a,i.mappingArea);o||(o={x:0,y:0,r:"",t:"",p:"",i:!1}),i.autoAssignRT.length>0&&(o.r=i.autoAssignRT[0].r,o.t=i.autoAssignRT[0].t,o.p=i.autoAssignRT[0].p),null==o.t&&(o.t=n.html());var r=parseInt(o.t)+1;$("#tx"+i.mappingArea).html(parseInt(o.t)),i.autoAssignRT=[],i.autoAssignRT.push({r:o.r,t:r,p:o.p}),l.updateObjectSeatPoints(a,i.mappingArea,o),i.autoAssignDone.push(i.mappingArea),i.timer1&&clearTimeout(i.timer1),i.timer1=setTimeout((function(){$(".cr").removeClass("assign"),i.autoAssign=!1,i.autoAssignRT=[],i.autoAssignDone=[]}),2e3)}}),!1),t.container.addEventListener("click",(function(t){"drawing"===i.appMode&&!i.isDraw&&i.currentType&&(h.hide(),l.setIsDraw(!0),i.newArea=R.createAndStartDrawing(l,s.getRightCoords(t.pageX,t.pageY)))}),!1);var Y=function(t){if(i.autoAlignXY.length>1){var e,n,a,o=0;if(i.autoAlignXY[0].x>i.autoAlignXY[1].x){var r=i.autoAlignXY;i.autoAlignXY[0]=r[1],i.autoAlignXY[1]=r[0]}e=i.autoAlignXY[1].x-i.autoAlignXY[0].x,n=Math.abs(i.autoAlignXY[1].y-i.autoAlignXY[0].y),a=Math.atan(n/e);var s=[];$(".cr").each((function(t){var e=parseInt($(this).attr("cx")),n=parseInt($(this).attr("cy"));if(e-i.autoAlignXY[0].x>0&&i.autoAlignXY[1].x-e>0&&(n>=i.autoAlignXY[1].y&&n<=i.autoAlignXY[0].y||n<=i.autoAlignXY[1].y&&n>=i.autoAlignXY[0].y||n==i.autoAlignXY[1].y||n==i.autoAlignXY[1].y+1||n==i.autoAlignXY[1].y-1||n==i.autoAlignXY[1].y+2||n==i.autoAlignXY[1].y-2||n==i.autoAlignXY[1].y+3||n==i.autoAlignXY[1].y-3)){var o=e-i.autoAlignXY[0].x,r=o*Math.tan(a);console.log("a2 = "+o+" b2 = "+r),console.log("cy = "+n+" y0 = "+i.autoAlignXY[0].y+" y1 = "+i.autoAlignXY[1].y+" "+r);var c=i.autoAlignXY[1].y<i.autoAlignXY[0].y?i.autoAlignXY[0].y-r:r+i.autoAlignXY[0].y;Math.abs(n-c)<=10&&(s.push($(this).attr("data-index")),$(this).addClass("align"))}})),s.reverse();for(var c=e/(s.length+1),d=i.autoAlignXY[0].x,u=l.getObjectSeatPoints(l.getSelectedArea(),$("#cr"+s[0]).attr("data-index"));o<s.length;){var p=d+=c,g=void 0;g=i.autoAlignXY[1].y<i.autoAlignXY[0].y?(i.autoAlignXY[0].x-d)*Math.tan(a)+i.autoAlignXY[0].y:(i.autoAlignXY[0].x-d)*Math.tan(a)*-1+i.autoAlignXY[0].y;var h=$("#cr"+s[o]).attr("data-index");$("#cr"+s[o]).attr("cx",p),$("#tx"+s[o]).attr("x",p),$("#cr"+s[o]).attr("cy",g),$("#tx"+s[o]).attr("y",g);var f=l.getObjectSeatPoints(l.getSelectedArea(),h);f||(f={x:0,y:0,r:"",t:"",p:"",i:!1}),f.x=(p-i.svg_width)/i.max_times,f.y=(g-i.svg_height)/i.max_times,t&&(f.x=(p-i.svg_width)/i.max_times,f.y=(g-i.svg_height)/i.max_times,f.t=parseInt(u.t)+h-1,f.r=u.r),l.updateObjectSeatPoints(l.getSelectedArea(),h,f),o++}console.log("align start"),i.autoAlignXY=[],i.autoAlign=!1,i.timer1&&clearTimeout(i.timer1),i.timer1=setTimeout((function(){$(".cr").removeClass("align"),i.autoAlign=!1}),1e3)}i.timer2&&clearTimeout(i.timer2),i.timer2=setTimeout((function(){$(".cr").removeClass("align"),i.autoAlign=!1,i.autoAlignXY=[],console.log("align stoped")}),2e3)},q=function(t,e){var n=parseInt($("#cr"+i.mappingArea).attr("cx")),a=parseInt($("#cr"+i.mappingArea).attr("cy")),o=$("#cr"+i.mappingArea).attr("data-index");switch(t){case v:a-=1;break;case b:a+=1;break;case y:n-=1;break;case _:n+=1}$("#cr"+i.mappingArea).attr("cx",n),$("#cr"+i.mappingArea).attr("cy",a),$("#tx"+i.mappingArea).attr("x",n),$("#tx"+i.mappingArea).attr("y",a);var r=l.getSelectedArea(),s=l.getObjectSeatPoints(r,o);s||(s={x:0,y:0,r:"",t:"",p:"",i:!1}),s.x=(n-i.svg_width)/i.max_times,s.y=(a-i.svg_height)/i.max_times,l.updateObjectSeatPoints(l.getSelectedArea(),o,s)};document.addEventListener("keydown",(function(t){var e=t.ctrlKey||t.metaKey;switch(t.keyCode>47&&t.keyCode<58&&i.autoDraw.active&&(i.autoDraw.count+=t.keyCode-48+""),t.keyCode){case T:case p:break;case C:"mapping"===i.appMode&&i.selectedArea&&(i.autoAlign=!0,i.timer1&&clearTimeout(i.timer1),i.timer1=setTimeout((function(){i.autoAlign=!1}),1e3));break;case E:"mapping"===i.appMode&&i.selectedArea&&(i.autoAlign=!0,i.autoAssignRow=!0,i.timer1&&clearTimeout(i.timer1),i.timer1=setTimeout((function(){i.autoAlign=!1}),1e3));break;case L:"mapping"===i.appMode&&i.selectedArea&&(i.autoDraw.count="",i.autoDraw.active=!0,i.autoDraw.points=[],i.timer1&&clearTimeout(i.timer1),i.timer1=setTimeout((function(){i.autoDraw.count="",i.autoDraw.active=!1}),1e4));break;case A:"mapping"===i.appMode&&i.selectedArea&&(i.autoAssign=!i.autoAssign,i.autoAssignDone=[],console.log("assign "+i.autoAssign));break;case g:i.isDraw?(i.isDraw=!1,i.newArea.remove(),i.areas.pop(),l.removeAllEvents()):"editing"===i.appMode&&(i.selectedArea.redraw(),l.removeAllEvents());break;case v:"mapping"===i.appMode&&q(v,i.mappingArea),"editing"===i.appMode&&i.selectedArea&&(i.selectedArea.move(0,-1),t.preventDefault());break;case b:"mapping"===i.appMode&&q(b,i.mappingArea),"editing"===i.appMode&&i.selectedArea&&(i.selectedArea.move(0,1),t.preventDefault());break;case y:"mapping"===i.appMode&&q(y,i.mappingArea),"editing"===i.appMode&&i.selectedArea&&(i.selectedArea.move(-1,0),t.preventDefault());break;case _:"mapping"===i.appMode&&q(_,i.mappingArea),"editing"===i.appMode&&i.selectedArea&&(i.selectedArea.move(1,0),t.preventDefault());break;case x:case S:"editing"===i.appMode&&i.selectedArea&&(l.removeObject(i.selectedArea),i.selectedArea=null,f.unload());break;case O:e&&l.saveInLocalStorage();break;case M:"editing"===i.appMode&&i.selectedArea&&e&&(t.preventDefault(),console.log("KEYS.C"),i.selectedArea=i.selectedArea.copy(B,i.selectedArea));break;case D:console.log("KEY U"),"editing"===i.appMode&&i.selectedArea&&e&&(t.preventDefault(),i.selectedArea=i.selectedArea.rotate(i.selectedArea,1));break;case N:console.log("KEY J"),"editing"===i.appMode&&i.selectedArea&&e&&(t.preventDefault(),i.selectedArea=i.selectedArea.rotate(i.selectedArea,-1));break;case P:if(console.log("KEY Z"),"mapping"===i.appMode&&e){var n=i.updateObjectSeatPointsHistory.pop();if(void 0===n)return;i.selectedArea._seats=n.seats,l.createMappingPolygon(),t.preventDefault()}}}),!1),document.querySelector("#svg_mapping").addEventListener("click",(function(){document.querySelector("#seat_mapping_close").focus()}),!1);var J,B={toJSON:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={_id:i._id,title:i.title,stats:i.stats,areas:[],img:i.image.src,img_width:$("#svg").width(),cfs:[],pcfs:[]};return i.areas.map((function(t){e.areas.push(t.toJSON())})),void 0===i.cfs&&(i.cfs=[]),e.cfs=JSON.parse(JSON.stringify(i.cfs)),void 0===i.pcfs&&(i.pcfs=[]),e.pcfs=JSON.parse(JSON.stringify(i.pcfs)),t?JSON.stringify(e):e},fromJSON:function(t){var e=JSON.parse(t);l.loadImage(e.img),e.areas.map((function(t){l.fromJSONArea(t)}))}},U=(J="seatMapCreator",{save:function(){var t=B.toJSON(!1),i=new F(null,l.getLayout(),l.getJSONCF());t.stats=i.getStats(),window.localStorage.setItem(J,t),n(),window.userClick&&n(),window.userClick=!1,console.log(window.layout),t.img||(t=window.layout),t._id||(t._id=window.layout._id),t.title||(t.title=window.layout.title);var s=function(t){var n=new Blob([JSON.stringify(t)],{type:"text/plain"}),i=new File([n],t._id+".json",{type:"text/plain"}),s=new FormData;s.append("id",t._id),s.append("sid",o()),s.append("pid",0),s.append("key","file"),s.append("file",i),s.append("slug","layout-"+t._id+".json"),s.append("token",r("kenzap_token")),fetch("https://api-v1.kenzap.cloud/upload/",{body:s,method:"post"}).then((function(t){return t.json()})).then((function(t){t.success&&(a(),(t=>{if(!document.querySelector(".toast")){let t='\n        <div class="toast-cont position-fixed bottom-0 p-2 m-4 end-0 align-items-center" style="z-index:10000;">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>';document.querySelector("body > div")&&document.querySelector("body > div").insertAdjacentHTML("afterend",t)}let e=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=t,e.show()})(e("Layout updated")))})),t=JSON.stringify(t)};fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:c(),body:JSON.stringify({query:{event:{type:"update",key:"myticket-layout",id:t._id,sid:o(),data:{title:t.title,stats:t.stats,img:t.img,img_width:t.img_width,created:t.created,updated:t.updated}}}})}).then((function(t){return t.json()})).then((function(e){e.success?s(t):d(e)})).catch((function(t){d(t)}))},restore:function(){console.log("restoring"),B.fromJSON(window.localStorage.getItem(J))}});return{domElements:t,saveInLocalStorage:U.save,loadFromLocalStorage:U.restore,hide:function(){return s.hide(t.container),this},show:function(){return s.show(t.container),this},recalcOffsetValues:function(){return z(),this},setDimensions:function(e,n){return t.svg.setAttribute("width",e),t.svg.setAttribute("height",n),t.container.style.width=e+"px",t.container.style.height=n+"px",this},structCustomField:function(t){var e=document.createElement("div");e.className="custom-field form-group mb-3",e.dataset.index=t.index;var n=document.createElement("label");n.setAttribute("for","cf"+t.index);var a=document.createElement("input");a.value=t.label,a.className="cfl",a.setAttribute("autocomplete","off");var o=document.createElement("span");o.className="mdi mdi-trash-can-outline text-danger delete-cfl",o.innerHTML='                   <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">                       <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>                       <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>                   </svg>',o.dataset.type="remove",o.dataset.index=t.index;var r=document.createElement("input");return r.id="cf"+t.index,r.className="cf form-control",r.setAttribute("autocomplete","off"),o.addEventListener("click",(function(t){"remove"===t.currentTarget.dataset.type&&(confirm("Remove this field and its values for all zones?")&&(i.cfs=i.cfs.filter((function(e){return e.index!=t.currentTarget.dataset.index})),console.log(i.cfs),t.currentTarget.parentNode.parentNode.parentNode.parentNode.querySelector('[data-index="'+t.currentTarget.dataset.index+'"]').remove()));t.preventDefault()})),a.addEventListener("input",(function(t){i.cfs=i.cfs.map((function(e){return console.log(e.index+" "+t.target.parentNode.parentNode.dataset.index),e.index==parseInt(t.target.parentNode.parentNode.dataset.index)&&(e.label=t.target.value),console.log(e),e})),t.preventDefault()})),r.addEventListener("input",(function(t){t.preventDefault()})),n.appendChild(a),n.appendChild(o),e.appendChild(n),e.appendChild(r),e},structPriceField:function(t){var e=document.createElement("div");e.className="custom-price-field form-group mb-3",e.dataset.index=t.index;var n=document.createElement("label");n.setAttribute("for","pcf"+t.index);var a=document.createElement("input");a.value=t.label,a.className="pcfl",a.setAttribute("autocomplete","off");var o=document.createElement("span");o.className="mdi mdi-trash-can-outline text-danger delete-pcfl",o.innerHTML='                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>                        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>                    </svg>',o.dataset.type="remove",o.dataset.index=t.index;var r=document.createElement("input");return r.id="pcf"+t.index,r.className="pcf form-control",r.setAttribute("autocomplete","off"),r.setAttribute("type","number"),o.addEventListener("click",(function(t){"remove"===t.currentTarget.dataset.type&&(confirm("Remove this variation and its values for all zones?")&&(i.pcfs=i.pcfs.filter((function(e){return e.index!=t.currentTarget.dataset.index})),console.log(i.pcfs),i.cfs=i.cfs.filter((function(e){return e.index!=t.currentTarget.dataset.index})),t.currentTarget.parentNode.parentNode.parentNode.parentNode.querySelector('[data-index="'+t.currentTarget.dataset.index+'"]').remove(),0==i.pcfs&&$("#zone_price").fadeIn(0)));t.preventDefault()})),a.addEventListener("input",(function(t){i.pcfs=i.pcfs.map((function(e){return console.log(e.index+" "+t.target.parentNode.parentNode.dataset.index),e.index==parseInt(t.target.parentNode.parentNode.dataset.index)&&(e.label=t.target.value),console.log(e),e})),t.preventDefault()})),r.addEventListener("input",(function(t){t.preventDefault()})),n.appendChild(a),n.appendChild(o),e.appendChild(n),e.appendChild(r),e},loadImage:function(e){return m.showLoadIndicator(),t.img.src=e,i.image.src=e,t.img.onload=function(){m.hideLoadIndicator().hide(),l.show().setDimensions(t.img.width,t.img.height).recalcOffsetValues(),$("#polygon").trigger("click")},this},preview:(t.img.setAttribute("usemap","#map"),t.map=document.createElement("map"),t.map.setAttribute("name","map"),t.container.appendChild(t.map),function(){return f.unload(),l.setShape(null),s.hide(t.svg),t.map.innerHTML=l.getHTMLCode(),h.print(),this}),hidePreview:function(){return s.show(t.svg),t.map.innerHTML="",this},addNodeToSvg:function(e){return t.svg.appendChild(e),this},removeNodeFromSvg:function(e){return t.svg.removeChild(e),this},getOffset:function(t){switch(t){case"x":case"y":return i.offset[t]}},clear:function(){for(i.areas.length=0;t.svg.childNodes[0];)t.svg.removeChild(t.svg.childNodes[0]);return h.hide(),f.unload(),this},removeObject:function(t){return i.areas.map((function(e,n){e===t&&i.areas.splice(n,1)})),t.remove(),this},updateObjectSeats:function(t,e,n){return i.areas.map((function(a,o){a===t&&(i.areas[o]._seats[e]=n)})),this},getObjectSeats:function(t,e){var n="";return i.areas.map((function(a,o){a===t&&(void 0===i.areas[o]._seats&&(i.areas[o]._seats={}),n=i.areas[o]._seats[e])})),n},updateObjectSeatPoints:function(t,e,n){var a=this;return i.areas.map((function(o,r){if(o===t){i.updateObjectSeatPointsHistory.push(JSON.parse(JSON.stringify(i.areas[r]))),i.updateObjectSeatPointsHistory.legth>25&&i.updateObjectSeatPointsHistory.shift(),void 0!==n.x&&(n.x=parseInt(1e3*n.x)/1e3),void 0!==n.y&&(n.y=parseInt(1e3*n.y)/1e3),void 0===n.t&&(n.t=parseInt(e)+1),null==n.t&&(n.t=parseInt(e)+1),""==n.t&&(n.t=parseInt(e)+1),n.t=n.t+"",void 0!==n.p&&(n.p=n.p+""),void 0!==n.r&&(n.r=n.r+"");for(var s=document.querySelector("#svg_mapping_cont polygon").getAttribute("points").split(" "),c=[],d=0;d<s.length;d+=2)c.push({x:parseFloat(s[d]),y:parseFloat(s[d+1])});if(document.querySelector("#cr"+e)){var l=parseInt(document.querySelector("#cr"+e).getAttribute("cx")),u=parseInt(document.querySelector("#cr"+e).getAttribute("cy"));n.i=a.isPointInsidePolygon([l,u],c),document.querySelector("#cr"+e).setAttribute("data-inside",n.i),document.querySelector("#tx"+e).setAttribute("data-inside",n.i),console.log(n),i.areas[r]._seats.points[e]=n}}})),this},getObjectSeatPoints:function(t,e){var n="";return i.areas.map((function(a,o){a===t&&(n=i.areas[o]._seats.points[e])})),n},isPointInsidePolygon:function(t,e){for(var n=t[0],a=t[1],i=!1,o=0,r=e.length-1;o<e.length;r=o++){var s=e[o].x,c=e[o].y,d=e[r].x,l=e[r].y;c>a!=l>a&&n<(d-s)*(a-c)/(l-c)+s&&(i=!i)}return i},setSilent:function(t){i.silent=t},resetAreaSeats:function(){i.updateObjectSeatPointsHistory.push(JSON.parse(JSON.stringify(i.selectedArea))),i.selectedArea._seats.points=[],l.createMappingPolygon()},updateSeatNumber:function(){if(l.getSelectedArea()){var t=l.getObjectSeatPoints(l.getSelectedArea(),$("#seat_text_in").data("index"));t.t=$("#seat_text_in").val(),$("#tx"+$("#seat_text_in").data("index")).html($("#seat_text_in").val()),l.updateObjectSeatPoints(l.getSelectedArea(),$("#seat_text_in").data("index"),t)}},updateSeatRow:function(){if(l.getSelectedArea()){var t=l.getObjectSeatPoints(l.getSelectedArea(),$("#seat_text_in").data("index"));t.r=$("#seat_row_in").val(),l.updateObjectSeatPoints(l.getSelectedArea(),$("#seat_row_in").data("index"),t)}},updateSeatPrice:function(){if(l.getSelectedArea()){var t=l.getObjectSeatPoints(l.getSelectedArea(),$("#seat_text_in").data("index"));t.p=$("#seat_price_in").val(),l.updateObjectSeatPoints(l.getSelectedArea(),$("#seat_price_in").data("index"),t)}},getLayout:function(){return i.areas},exportSeats:function(){var t=B.toJSON();document.querySelector("#exportTextArea").innerHTML=t;var e=document.querySelector("#kenzap_export");new bootstrap.Modal(e).show()},importSeats:function(){try{var t=$("#importTextArea").val();t=t.trim();var e=JSON.parse(t);delete e._id,l.loadLayout("-",e),$("#kenzap_export").modal("hide")}catch(t){console.log(t),alert("Error parsing JSON structure")}},deselectAll:function(){return i.areas.map((function(t){t.deselect()})),this},getIsDraw:function(){return i.isDraw},setIsDraw:function(t){return i.isDraw=t,this},setMode:function(t){return i.appMode=t,this},getMode:function(){return i.appMode},setShape:function(t){return i.currentType=t,this},getShape:function(){return i.currentType},addObject:function(t){return i.areas.push(t),this},getNewArea:function(){return i.newArea},resetNewArea:function(){return i.newArea=null,this},getSelectedArea:function(){return i.selectedArea},setSelectedArea:function(t){return i.selectedArea=t,this},getEditType:function(){return i.editType},setFilename:function(t){return i.image.filename=t,this},getFilename:function(){return i.image.filename},setEditClass:function(){return t.container.classList.remove("draw"),t.container.classList.add("edit"),this},setDrawClass:function(){return t.container.classList.remove("edit"),t.container.classList.add("draw"),this},setDefaultClass:function(){return t.container.classList.remove("edit"),t.container.classList.remove("draw"),this},addEvent:function(t,e,n){return i.events.push(new u(t,e,n)),this},removeAllEvents:function(){return i.events.map((function(t){t.remove()})),i.events.length=0,this},getHTMLCode:function(t){var e="";if(t){if(!i.areas.length)return"0 objects";e+=s.encode('<img src="'+i.image.filename+'" alt="" usemap="#map" />')+"<br />"+s.encode('<map name="map">')+"<br />",s.foreachReverse(i.areas,(function(t){e+="&nbsp;&nbsp;&nbsp;&nbsp;"+s.encode(t.toHTMLMapElementString())+"<br />"})),e+=s.encode("</map>")}else s.foreachReverse(i.areas,(function(t){e+=t.toHTMLMapElementString()}));return e},fromJSONArea:function(t){var e;switch(t.type){case"polygon":e=new R(l,t.coords,t.seats,t.attributes);break;case"circle":e=new H(l,t.coords,t.seats,t.attributes);break;case"rectangle":e=new k(l,t.coords,t.seats,t.attributes)}if(!e)throw new Error("This area type is not valid");return l.setIsDraw(!0),l.setIsDraw(!1).resetNewArea(),e},getJSONCF:function(){return i.cfs},fromJSONCF:function(t){i.cfs=t},getJSONPCF:function(){return i.pcfs},fromJSONPCF:function(t){i.pcfs=t},fromJSONKey:function(t,e){i[t]=e},foreach:function(t,e){for(var n=0,a=t.length;n<a;n++)e(t[n],n)},loadLayout:function(t,e){var n=new Image;n.src="-"==t?e.img:"https://cdn.kenzap.com/myticket/"+t,n.onload=function(){a(),l.loadImage(n.src).setFilename(n.src),l.fromJSONCF(e.cfs),l.fromJSONPCF(e.pcfs),l.fromJSONKey("_id",e._id),l.fromJSONKey("title",e.title),l.fromJSONKey("stats",e.stats),e.areas.map((function(t){l.fromJSONArea(t)})),$("#polygon").trigger("click")}},createMappingPolygon:function(){var t,e=$("#svg_mapping"),n=$("#img_section"),a=$(window).width()-100,o=$(window).height()-100,r=l.getSelectedArea();if($("#seat_mapping, #top_toolbar, #seat_notice").fadeIn(),$("#seat_row,#seat_text,#seat_price").fadeOut(0),$("#seat_text_vis_cb").off("click"),$("#seat_text_vis_cb").click((function(t){$(this).is(":checked")?$("body").addClass("stv"):$("body").removeClass("stv")})),e.html(""),$("#ul-slider-5").length){(t=r._seats.height)||(t=100);var c=document.getElementById("ul-slider-5");c.noUiSlider&&c.noUiSlider.destroy(),noUiSlider.create(c,{start:[t],connect:[!0,!1],range:{min:[25],max:[125]}},!0),c.noUiSlider.on("slide",(function(t,n,a,i,o){console.log(parseInt(t[0])),l.updateObjectSeats(l.getSelectedArea(),"height",parseInt(t[0])),$(".cr").each((function(n){$(this).attr("r",e.attr("data-height")*(parseInt(t[0])/100))}))}))}var d,u,p=0,g=0,h=0;r._coords.points.map((function(t){return h++,p+=t.x,g+=t.y,t})),d=p/h,u=g/h;var f,m=0,v=0;r._coords.points_rel=[],r._coords.points.map((function(t){var e=Math.abs(d-t.x);e=Math.abs(d-t.x),v=e>v?e:v,e=Math.abs(u-t.y),m=e>m?e:m,r._coords.points_rel.push({x:t.x-d,y:t.y-u})})),e.css("width",a),e.css("height",o);var b=a/2/v,y=o/2/m;f=b<y?b:y,b=0,y=0;var _=0,w=0,x=!0,S=r._coords.points_rel.map((function(t){var e=t.x*f+a/2,n=t.y*f+o/2;return x||(b+=_*t.y*f,y+=w*t.x*f),_=t.x*f,w=t.y*f,x=!1,e+" "+n})).join(" "),A=document.createElementNS(s.SVG_NS,"g"),E=document.createElementNS(s.SVG_NS,"polygon");E.setAttribute("points",S),A.appendChild(E),e.append(A);var k=9999999;r._coords.points.map((function(t){return t.y*f<k&&(k=t.y*f),t.x*f+" "+t.y*f})).join(" "),r._seats.bg,e.css("background-image","none"),n.attr("src",l.getFilename()),n.css("width",parseInt($("#svg").width())*f),n.css("left",a/2-d*f+80),n.css("top",o/2-u*f+80);var C=Math.round(Math.abs(y-b))/2,L=r._seats.tws,T=r._seats.price,O=Math.sqrt(C/L);for(e.attr("data-height",O/2),O*=parseInt(t)/100,h=0;h<L;){var M=document.createElementNS(s.SVG_NS,"g");M.setAttribute("id","dc"+h),M.setAttribute("data-index",h);var N=document.createElementNS(s.SVG_NS,"circle");N.setAttribute("id","cr"+h),N.setAttribute("cx",O/2),N.setAttribute("cy",O/2),N.setAttribute("r",O/2),N.setAttribute("class","cr"),N.setAttribute("data-index",h),N.setAttribute("data-inside",!1);var D=document.createElementNS(s.SVG_NS,"text");if(D.setAttribute("id","tx"+h),D.setAttribute("x",O/2),D.setAttribute("y",O/2),D.setAttribute("dy",".3em"),D.setAttribute("stroke-width","1px"),D.setAttribute("text-anchor","middle"),D.setAttribute("stroke","#51c5cf"),D.setAttribute("data-index",h),D.setAttribute("data-inside",!1),D.setAttribute("data-toggle","popover"),D.setAttribute("title","Seat Settings"),D.setAttribute("data-content","test"),D.setAttribute("data-price",T),D.innerHTML=h+1,null==r._seats.points&&(r._seats.points=[]),r._seats.points[h]){var P=r._seats.points[h].x*f+a/2,z=r._seats.points[h].y*f+o/2,I=r._seats.points[h].i;N.setAttribute("cx",P),N.setAttribute("cy",z),N.setAttribute("data-inside",I),D.setAttribute("x",P),D.setAttribute("y",z),D.setAttribute("data-inside",I),r._seats.points[h].t&&(D.innerHTML=r._seats.points[h].t)}M.appendChild(N),M.appendChild(D),M.obj=this,e.append(M),h++}h=0,l.setMode("mapping"),i.max_times=f,i.cp.x=d,i.cp.y=u,i.svg_width=a/2,i.svg_height=o/2,$("#svg_mapping").offset()}}}();function u(t,e,n){this.target=t,this.eventType=e,this.func=n,t.addEventListener(e,n,!1)}u.prototype.remove=function(){this.target.removeEventListener(this.eventType,this.func,!1)};var p,g,h=(p=s.id("code"),g=s.id("code_content"),p.querySelector(".close_button").addEventListener("click",(function(t){s.hide(p),t.preventDefault()}),!1),{print:function(){g.innerHTML=l.getHTMLCode(!0),s.show(p)},hide:function(){s.hide(p)}}),f=function(){var t,e,n,a,i,o=s.id("edit_details"),r=o.querySelector("h5"),c=s.id("href_attr"),d=s.id("alt_attr"),u=s.id("title_attr"),p=s.id("save_details"),g=o.querySelector(".close_button"),h=o.querySelectorAll("p");function f(){o.classList.remove("changed"),s.foreach(h,(function(t){t.classList.remove("changed")}))}function m(){t=null,f(),s.hide(o)}function v(t,e){o.style.left=t+5+"px",o.style.top=e+5+"px"}function b(t){v(e+t.pageX-a,n+t.pageY-i)}function y(t){e=e+t.pageX-a,n=n+t.pageY-i,v(e,n),l.removeAllEvents()}function _(){o.classList.add("changed"),this.parentNode.classList.add("changed")}return p.addEventListener("click",(function(e){t.setInfoAttributes({id:id_attr.value,href:c.value,alt:d.value,title:u.value}),t[t.href?"setStyleOfElementWithHref":"unsetStyleOfElementWithHref"](),f(),m(),e.preventDefault()}),!1),c.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),d.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),u.addEventListener("keydown",(function(t){t.stopPropagation()}),!1),c.addEventListener("change",_,!1),d.addEventListener("change",_,!1),u.addEventListener("change",_,!1),g.addEventListener("click",m,!1),r.addEventListener("mousedown",(function(t){a=t.pageX,i=t.pageY,l.addEvent(document,"mousemove",b),l.addEvent(r,"mouseup",y),t.preventDefault()}),!1),{load:function(a,i,r){t=a,c.id=a.id?a.id:"",c.value=a.href?a.href:"",d.value=a.alt?a.alt:"",u.value=a.title?a.title:"",s.show(o),i&&r&&v(e=i,n=r)},unload:m}}();!function(){var t=s.id("from_html_wrapper"),e=s.id("code_input"),n=s.id("load_code_button"),a=t.querySelector(".close_button");function i(){s.hide(t)}n.addEventListener("click",(function(t){Area.createAreasFromHTMLOfMap(e.value)&&i(),t.preventDefault()}),!1),a.addEventListener("click",i,!1)}();var m=function(){var t,e=s.id("get_image_wrapper"),i=e.querySelector(".close_button"),r=s.id("loading"),c=s.id("button"),d=null,u=null,p=function(){var t=s.id("dropzone"),e=t.querySelector(".clear_button"),i=s.id("sm_img");function o(){i.src="",s.hide(i).hide(e),t.classList.remove("error"),u=g}return t.addEventListener("dragover",(function(t){s.stopEvent(t)}),!1),t.addEventListener("dragleave",(function(t){s.stopEvent(t)}),!1),t.addEventListener("drop",(function(r){s.stopEvent(r);var c=new FileReader,g=r.dataTransfer.files[0];!function(t){switch(t){case"image/jpeg":case"image/gif":case"image/png":return!0}return!1}(g.type)?(o(),t.classList.add("error")):(t.classList.remove("error"),c.readAsDataURL(g),c.onload=function(t){i.src=t.target.result,i.style.display="inline-block",d=g.name,s.show(e),u=p;var o=new FormData,r=s.getUrlParameter("id");o.append("file",g),o.append("id",r),o.append("cmd","store_image"),o.append("type","myticket"),o.append("token",s.getCookie("kenzap_token")),n(),$.ajax({url:"https://fileapi.kenzap.com/v1/",cmd:"store_image",type:"post",data:o,contentType:!1,processData:!1,success:function(t){var e=JSON.parse(t);e.success?setTimeout((function(){var t=new Date,e="https://cdn.kenzap.com/myticket/"+r+".jpeg?"+t.getTime();console.log("store_image 1 "+e),document.querySelector("#img").setAttribute("src",e),l.loadImage(e).setFilename(e),a()}),12e3):alert("Unable to save: "+e.reason)}})})}),!1),e.addEventListener("click",o,!1),{clear:o,init:function(){t.draggable=!0,this.clear(),s.hide(i).hide(e)},test:function(){return Boolean(i.src)},getImage:function(){return i.src}}}(),g=function(){var t=s.id("url"),e=t.parentNode.querySelector(".clear_button");function n(){setTimeout((function(){t.value.length?(s.show(e),u=g):(s.hide(e),u=p)}),0)}function a(){t.value="",s.hide(e),t.classList.remove("error"),u=g}return t.addEventListener("keypress",n,!1),t.addEventListener("change",n,!1),t.addEventListener("paste",n,!1),e.addEventListener("click",a,!1),{clear:a,init:function(){this.clear(),s.hide(e)},test:function(){return function(t){var e=t.trim().split(".");if(e.length>1)switch(e[e.length-1].toLowerCase()){case"jpg":case"jpeg":case"gif":case"png":return!0}return!1}(t.value)?(t.classList.remove("error"),!0):(t.classList.add("error"),!1)},getImage:function(){var e=t.value.split("/");return d=e[e.length-1],t.value.trim()}}}();function h(){p.clear(),g.clear(),u=null,s.show(e)}function f(){s.hide(e)}return s.hide(r),p.init(),g.init(),s.getUrlParameter("id").length>=40?fetch("https://kenzap-sites.oss-ap-southeast-1.aliyuncs.com/S"+o()+"/layout-"+window.layout._id+".json?"+(new Date).getTime()).then((function(t){return t.blob()})).then((function(t){return t.text()})).then((function(t){var e=JSON.parse(t);e.title=window.layout.title,l.loadLayout("-",e),a()})).catch((function(t){a()})):((t=new FormData).append("id",s.getUrlParameter("id")),t.append("cmd","get_layout"),$.ajax({url:"https://api.kenzap.com/myticket/",type:"post",headers:{"Kenzap-Token":s.getCookie("kenzap_token")},data:t,contentType:!1,processData:!1,success:function(t){var n=t;if(n.success){var i=n.img;i||(i="-"),"-"!=i||n.layout.extra.img?n.layout.extra._id?fetch("https://kenzap-sites.oss-ap-southeast-1.aliyuncs.com/S"+o()+"/layout-"+n.layout.extra._id+".json?"+(new Date).getTime()).then((function(t){return t.blob()})).then((function(t){return t.text()})).then((function(t){var e=JSON.parse(t);e.title=n.layout.title,l.loadLayout("-",e)})).catch((function(t){console.log(t),console.log(n.layout),l.loadLayout("-",n.layout.extra)})):l.loadLayout(i,n.layout.extra):a()}else{switch(a(),n.code){case 10:window.location.replace("https://auth.kenzap.com/?app=65432108792785&redirect=https://myticket.kenzap.cloud/"),e=!0,clearInterval(myTimer);break;case 11:alert("Ooops. Something went wrong. Please close this window and try again!"),e=!0,clearInterval(myTimer)}console.log("Oops! "+n.reason)}}})),c.addEventListener("click",(function(t){u===g&&g.test()?l.loadImage(g.getImage()).setFilename(d):u===p&&p.test()&&l.loadImage(p.getImage()).setFilename(d),t.preventDefault()}),!1),i.addEventListener("click",f,!1),{show:function(){return l.hide(),h(),this},hide:function(){return l.show(),f(),this},showLoadIndicator:function(){return s.show(r),this},hideLoadIndicator:function(){return s.hide(r),this}}}();m.show(),function(){var t=s.id("nav").getElementsByTagName("li"),e=s.id("save");s.id("load"),s.id("rectangle"),s.id("circle");var n=s.id("polygon"),a=s.id("edit");s.id("clear"),s.id("from_html"),s.id("to_html"),s.id("preview");var i=s.id("new_image");s.id("show_help");var o=s.id("seats"),r=s.id("saveSeatMap"),c=s.id("seat_row_in"),d=s.id("seat_text_in"),u=s.id("seat_price_in"),p=s.id("seat_mapping_close"),g=s.id("reset_zone_btn"),h=s.id("export"),v=s.id("import"),b=s.id("stats_btn");function y(){s.foreach(t,(function(t){t.classList.remove(s.CLASS_NAMES.SELECTED)}))}function _(t){y(),t.classList.add(s.CLASS_NAMES.SELECTED)}e.addEventListener("click",(function(t){window.userClick=!0,l.saveInLocalStorage(),t.preventDefault()}),!1),n.addEventListener("click",(function(t){$(".btna").removeClass("btn-primary").addClass("btn-outline-primary"),$("#"+this.id).addClass("btn-primary").removeClass("btn-outline-primary"),l.setMode("drawing").setDrawClass().setShape(this.id).deselectAll().hidePreview(),f.unload(),_(this),t.preventDefault()}),!1),a.addEventListener("click",(function(t){$(".btna").removeClass("btn-primary").addClass("btn-outline-primary"),$("#"+this.id).addClass("btn-primary").removeClass("btn-outline-primary"),"editing"===l.getMode()?(l.setMode(null).setDefaultClass().deselectAll(),y(),s.show(domElements.svg)):(l.setShape(null).setMode("editing").setEditClass(),_(this)),l.hidePreview(),t.preventDefault()}),!1),i.addEventListener("click",(function(t){confirm("This operation may break your current layout. Continue?")&&(l.setIsDraw(!1).hide().hidePreview(),y(),m.show()),t.preventDefault()}),!1),o.addEventListener("click",(function(t){$(".btna").removeClass("btn-primary").addClass("btn-outline-primary"),$("#"+this.id).addClass("btn-primary").removeClass("btn-outline-primary"),"seating"===l.getMode()?(l.setMode(null).setDefaultClass().deselectAll(),y()):(l.setShape(null).setMode("seating").setEditClass(),_(this)),l.hidePreview(),t.preventDefault()}),!1),r.addEventListener("click",(function(t){$("#kenzap_seat_map").attr("data-id"),l.updateObjectSeats(l.getSelectedArea(),"title",$("#zone_title").val()),l.updateObjectSeats(l.getSelectedArea(),"tws",$("#zone_tws").val()),l.updateObjectSeats(l.getSelectedArea(),"tns",$("#zone_tns").val()),l.updateObjectSeats(l.getSelectedArea(),"price",$("#zone_price").val()),l.updateObjectSeats(l.getSelectedArea(),"bg",$("#zone_bgi").val()),l.getJSONCF().map((function(t){l.updateObjectSeats(l.getSelectedArea(),t.id,$("#"+t.id).val())})),l.getJSONPCF().map((function(t){l.updateObjectSeats(l.getSelectedArea(),t.id,$("#"+t.id).val())})),l.createMappingPolygon()}),!1),p.addEventListener("click",(function(t){$("#top_toolbar").fadeOut(),$("#seat_mapping").fadeOut(),l.setSilent(!0),l.setMode("seating"),t.preventDefault()}),!1),c.addEventListener("keyup",(function(t){setTimeout((function(){l.updateSeatRow()}),200)}),!1),d.addEventListener("keyup",(function(t){setTimeout((function(){l.updateSeatNumber()}),200)}),!1),u.addEventListener("keyup",(function(t){setTimeout((function(){l.updateSeatPrice()}),200)}),!1),g.addEventListener("click",(function(t){setTimeout((function(){confirm("Reset all allocated seats?")&&l.resetAreaSeats()}),200)}),!1),h.addEventListener("click",(function(t){t.preventDefault(),l.exportSeats()}),!1),v.addEventListener("click",(function(t){l.clear(),l.importSeats()}),!1),b.addEventListener("click",(function(t){new F(document.getElementById("stats-body"),l.getLayout(),l.getJSONCF()).drawStats()}),!1)}()},Y={state:{firstLoad:!0,ajaxQueue:0},init:function(){((t,e)=>{if(!Array.from(document.querySelectorAll("script")).some((e=>e.src==t))){let n=document.createElement("script");n.onload=e,n.src=t,document.getElementsByTagName("head")[0].appendChild(n)}})("https://account.kenzap.com/js/nouislider.js",(function(){})),Y.getData()},getData:function(){var t,a;Y.state.firstLoad&&n(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:c(),body:JSON.stringify({query:{locale:{type:"locale",id:r("lang")},layout:{type:"find",fields:"*",key:"myticket-layout",sid:o(),id:(t="id",a=new URLSearchParams(window.location.search),a.get(t)?a.get(t):"")}}})}).then((function(t){return t.json()})).then((function(t){var n;t.success?(console.log(t),t.layout&&(window.layout=t.layout),(t=>{if(t.header&&localStorage.setItem("header",t.header),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(t),n=e("MyTicket 2.0.8 by %1$Kenzap%2$. ❤️ Licensed %3$GPLv3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),document.querySelector("footer .row").innerHTML='\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">'.concat(n,'</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">').concat("","</span>\n    </div>"),Y.loadHomeStructure(),Y.renderPage(),X()):d(t)})).catch((function(t){console.error("Error:",t)}))},renderPage:function(t){(t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let n of t)void 0===n.link?e+=`<li class="breadcrumb-item">${n.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${n.link}">${n.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:i("https://dashboard.kenzap.cloud?launcher=myticket"),text:e("Home")},{link:i("/"),text:e("MyTicket")},{link:i("/layout-list/"),text:e("Layouts")},{text:e("Editing")}])},initListeners:function(){console.log("initListeners "),Y.state.firstLoad&&((t,e)=>{if(document.querySelector(t))for(let n of document.querySelectorAll(t))n.removeEventListener("click",e,!0),n.addEventListener("click",e,!0)})(".btn-modal",Y.listeners.modalSuccessBtn)},listeners:{modalSuccessBtn:function(t){Y.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},loadHomeStructure:function(){Y.state.firstLoad&&(document.querySelector("#contents").innerHTML='\n\n        \x3c!-- seat mapping overlay controls --\x3e\n        <div id="seat_mapping">\n            <div id="top_toolbar">\n                <div id="seat_mapping_close_cnt" class="ms-3">\n                    <button id="seat_mapping_close" type="button" class="btn btn-primary btn-sm" >'.concat(e("Apply"),'</button>\n                </div>\n                <div id="seat_size" class="seat_head ms-3 me-1">').concat(e("Scale:"),'</div>\n                <div id="ul-slider-5" class="ul-slider slider-success"></div>\n                <div id="seat_notice" class="seat_head ms-3">').concat(e("Click on seat or drag it to a desired location."),'</div>\n                <div id="seat_row" class="seat_head ms-3">').concat(e("Seat Row:"),' <input id="seat_row_in" autocomplete="off" type="text" maxlength="6" class="form-control-sm" placeholder="-" ></div>\n                <div id="seat_text" class="seat_head ms-3">').concat(e("Seat Number: "),'<input id="seat_text_in" autocomplete="off" type="text" maxlength="12" class="form-control-sm" placeholder="-" ></div>\n                <div id="seat_price" class="seat_head ms-3">').concat(e("Seat Price: "),'<input id="seat_price_in" autocomplete="off" type="text" maxlength="12" class="form-control-sm" placeholder="-" ></div>\n                <div id="seat_text_vis" class="seat_head ms-3">\n                <div class="checkbox" >\n                    <input type="checkbox" id="seat_text_vis_cb" class="checkbox__input">\n                    <label for="seat_text_vis_cb" class="checkbox__label">').concat(e("Seat Numbering"),'</label>\n                </div>\n                </div>\n                <div id="reset_zone" class="seat_head ms-5" style=""><span id="reset_zone_btn">').concat(e("Reset all"),'</span></div>\n            </div>\n\n            <div id="svg_mapping_cont">\n                <img id="img_section" src="" alt="section preview" >\n                <svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny" id="svg_mapping"> </svg>\n            </div>\n\n            <div style="width:0%;height:100%;float:right;overflow-y:scroll;padding:20px;display: none;">\n                <ul id="svg_seats"> </ul>\n            </div>\n\n        </div>\n        \n        <div class="container p-edit">\n            <div class="d-flex justify-content-between bd-highlight mb-3">\n                <nav class="bc" aria-label="breadcrumb"></nav>\n            </div>\n            <div class="row">\n                <div class="col-lg-12 grid-margin stretch-card">\n                    <div class="card border-white shadow-sm">\n                        <div class="card-body">\n                            <div id="wrapper">\n                                <header id="header">\n                                    <nav id="nav" class="clearfix">\n                                        <div class="btn-group" role="group" aria-label="Basic example">\n                                            <button id="polygon" type="button" class="btn btna btn-outline-primary">').concat(e("draw"),'</button>\n                                            <button id="edit" type="button" class="btn btna btn-outline-primary">').concat(e("edit"),'</button>\n                                            <button id="seats" type="button" class="btn btna btn-outline-primary">').concat(e("assign"),'</button>\n                                            <button id="save" type="button" class="btn btna btn-outline-primary">').concat(e("save"),'</button>\n                                            <button id="new_image" type="button" class="btn btna btn-outline-primary">').concat(e("image"),'</button>\n                                            <button id="export-" type="button" class="btn btn-outline-primary d-none">').concat(e("export"),'</button>\n                                            <div class="more input-group dropdown">\n                                                <button id="more" type="button" class="btn btn-outline-primary" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">\n                                                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg></button>\n                                                <div class="dropdown-menu">\n                                                    <a class="dropdown-item" target="_blank" href="https://kenzap.com/seat-reservation-in-wordpress-setup-service-1014779/">').concat(e("Integration service"),'</a>\n                                                    <a class="dropdown-item" target="_blank" href="https://kenzap.blog/how-to-create-custom-concert-hall-in-wordpress-with-seat-reservation/">').concat(e("Free tutorial"),'</a>\n                                                    <a id="export" class="dropdown-item" target="_blank" href="#" >').concat(e("Export layout"),'</a>\n                                                    <a class="dropdown-item" target="_blank" href="#" data-bs-toggle="modal" data-bs-target="#kenzap_import">').concat(e("Import layout"),'</a>\n                                                    <a id="stats_btn" class="dropdown-item" target="_blank" href="#" data-bs-toggle="modal" style="" data-bs-target="#kenzap_stats">').concat(e("Layout stats"),'</a>\n                                                    <div role="separator" class="dropdown-divider"></div>\n                                                    <a class="dropdown-item" target="_blank" href="https://kenzap.com/myticket-events-plugin/">').concat(e("Community"),'</a>\n                                                </div>\n                                            </div>\n                                        </div>\n\n                                    </nav>\n                                    <div id="coords"></div>\n                                    <div id="debug"></div>\n                                </header>\n                                <div id="image_wrapper">\n                                    <div id="image">\n                                    <img src="" alt="#" id="img" style="max-width:1052px" />\n                                    <svg xmlns="http://www.w3.org/2000/svg" style="max-width:1052px" version="1.2" baseProfile="tiny" id="svg"></svg>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div id="get_image_wrapper">\n                                <div id="get_image">\n                                    <span title="close" class="close_button"></span>\n                                    <div id="loading">').concat(e("Loading"),'</div>\n                                    <div id="file_reader_support">\n                                        <label>').concat(e("Drag an image of your layout below"),'</label>\n                                        <div id="dropzone">\n                                            <span class="clear_button" title="clear">x</span>\n                                            <img src="" alt="preview" id="sm_img" />\n                                        </div>\n                                    </div>\n\n                                    <button id="button" type="button" style="margin-top:50px;" class="btn btn-outline-success ">').concat(e("Upload This Layout"),'</button>\n\n                                    <div style="display: none;">\n                                        <label for="url">type a url</label>\n                                        <span id="url_wrapper">\n                                            <span class="clear_button" title="clear">x</span>\n                                            <input type="text" id="url" />\n                                        </span>\n                                        <button id="button">').concat(e("OK"),'</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- For html image map code --\x3e\n        <div id="code">\n          <span class="close_button" title="close"></span>\n          <div id="code_content"></div>\n        </div>\n\n        \x3c!-- Edit details block --\x3e\n        <form id="edit_details">\n          <h5>Attributes</h5>\n          <span class="close_button" title="close"></span>\n          <p>\n            <label for="href_attr">href</label>\n            <input type="text" id="href_attr" />\n          </p>\n          <p>\n            <label for="alt_attr">alt</label>\n            <input type="text" id="alt_attr" />\n          </p>\n          <p>\n            <label for="title_attr">title</label>\n            <input type="text" id="title_attr" />\n          </p>\n          <button id="save_details">').concat(e("Save"),'</button>\n        </form>\n\n        \x3c!-- From html block --\x3e\n        <div id="from_html_wrapper">\n          <form id="from_html_form">\n            <h5>Loading areas</h5>\n            <span class="close_button" title="close"></span>\n            <p>\n              <label for="code_input">').concat(e("Enter your html code:"),'</label>\n              <textarea id="code_input"></textarea>\n            </p>\n            <button id="load_code_button">').concat(e("Load"),'</button>\n          </form>\n        </div>\n\n\n\n        <div id="kenzap_seat_map" class="modal">\n            <div class="modal-dialog" role="document">\n                \x3c!-- Modal content --\x3e\n                <div class="modal-content">\n        \n                    <div class="modal-header">\n                        <h5 class="modal-title">').concat(e("Zone Settings"),'</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n        \n                    <div class="modal-body">\n                        <div class="form-cont">\n                        \n                            <div class="form-group mb-3">\n                                <label for="zone_title" class="form-label">').concat(e("Zone label"),'</label>\n                                <input type="text" class="form-control" id="zone_title" autocomplete="off" placeholder="A2 or 1001">\n                            </div>\n                \n                            <div class="form-group mb-3">\n                                <label for="zone_tws" class="form-label">').concat(e("Number of seats"),'</label>\n                                <input type="number" class="form-control" id="zone_tws" autocomplete="off" placeholder="0" value="0">\n                            </div>\n                \n                            <div class="form-group mb-3">\n                                <label for="zone_tns" class="form-label">').concat(e("Number of passes"),'</label>\n                                <input type="number" class="form-control" id="zone_tns" autocomplete="off" placeholder="0" value="0">\n                            </div>\n                \n                            <div class="form-group mb-3">\n                                <label for="zone_price" class="form-label">').concat(e("Price variations"),'</label>\n                                <input type="number" class="form-control" id="zone_price" autocomplete="off" placeholder="0" value="0">\n                            </div>\n                \n                            <div class="form-price-custom">\n                \n                            </div>\n                \n                            <p class="form-link mb-1" style="text-align:right;"><a id="zone_add_price" href="#" data-attached="false">add price variation</a><a href="https://kenzap.blog/how-to-create-custom-concert-hall-in-wordpress-with-seat-reservation/#pricing" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info mb-2" viewBox="0 0 16 16">\n                                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>\n                                </svg></a>\n                            </p>\n                \n                \n                            <div class="form-group mb-3">\n                                <label for="zone_bg">').concat(e("Zone background (optional)"),'</label>\n                                <div>\n                                <img id="zone_bg" src="https://cdn.kenzap.com/loading.png" />\n                                <input type="hidden" id="zone_bgi" value="">\n                                <input type="file" name="img[]" class="dn bg-file" style="display:none;">\n                                <span class="remove" title="Remove">×</span>\n                                </div>\n                            </div>\n                \n                            <div class="form-group-custom">\n                \n                            </div>\n                \n                            <p class="form-link" style="text-align:right;">\n                                <a id="zone_add_field" href="#" data-attached="false">').concat(e("add custom field"),'</a>\n                                <a href="https://kenzap.blog/how-to-customize-pdf-ticket-with-myticket-events-plugin/#extension-fields" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info mb-2" viewBox="0 0 16 16">\n                                    <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>\n                                    </svg>\n                                </a>\n                            </p>\n                        \n                        </div>\n                    </div>\n                    \n                    <div class="modal-footer">\n                        <button id="saveSeatMap" type="button" class="btn btn-primary btn-modal" data-bs-dismiss="modal">').concat(e("Continue"),'</button>\n                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">').concat(e("Cancel"),'</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    \n    \n        <div id="kenzap_export" class="modal">\n            <div class="modal-dialog" role="document">\n                \x3c!-- Modal content --\x3e\n                <div class="modal-content">\n        \n                    <div class="modal-header">\n                        <h5 class="modal-title">').concat(e("Export Layout"),'</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n        \n                    <div class="modal-body">\n        \n                        <textarea class="form-control" id="exportTextArea" rows="4"></textarea>\n            \n                        <ol class="mt-2" >\n                            <li>').concat(e("Copy layout data above"),'</li>\n                            <li>Install <b><a target="_blank" href="https://wordpress.org/plugins/myticket-events/" target="_blank">MyTicket Events</a> </b> plugin</li>\n                            <li>').concat(e("Add <b>MyTicket Hall</b> block to your website"),"</li>\n                            <li>").concat(e("Paste the code under Layout / Seat Code in the right pane"),"</li>\n                            <li>").concat(e('For large layout imports refer to <b><a target="_blank" href="https://kenzap.blog/importing-layouts-with-5000-seats-myticket-events-plugin/">this guide</a></b>'),'</li>\n                        </ol>\n            \n                        <p style="font-size:10pt;margin-top:20px;font-style: italic;">').concat(e('Need help in designing your hall or stadium layout? <a target="_blank" href="https://kenzap.com/seat-reservation-in-wordpress-setup-service-1014779/">Contact support</a>.'),'</p>\n                    </div>\n        \n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-success" data-bs-dismiss="modal">').concat(e("Done"),'</button>\n                        <button type="button" class="btn btn-outline-dark btn-fw" data-bs-dismiss="modal">').concat(e("Cancel"),'</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    \n\n        <div id="kenzap_import" class="modal">\n            <div class="modal-dialog" role="document">\n                \x3c!-- Modal content --\x3e\n                <div class="modal-content">\n        \n                    <div class="modal-header">\n                        <h5 class="modal-title" id="ModalLabel">').concat(e("Import Layout"),'</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n        \n                    <div class="modal-body">\n        \n                        <textarea class="form-control" id="importTextArea" rows="4"></textarea>\n            \n                        <ol class="mt-4">\n                            <li>').concat(e("1. Backup current layout (make a copy)"),"</li>\n                            <li>").concat(e("2. Verify JSON data is valid"),"</li>\n                            <li>").concat(e("3. Paste your existing layout here"),'</li>\n                        </ol>\n            \n                        <p class="text-danger" style="font-size:10pt;margin-top:20px;font-style: italic;">').concat(e("Warning. Wrong JSON structure may break current layout."),'</p>\n                    </div>\n        \n                    <div class="modal-footer">\n                        <button id="import" type="button" class="btn btn-success" data-bs-dismiss="modal">').concat(e("Import"),'</button>\n                        <button type="button" class="btn btn-outline-dark btn-fw" data-bs-dismiss="modal">').concat(e("Cancel"),'</button>\n                    </div>\n                </div>\n            </div> \n        </div>\n    \n\n        <div id="kenzap_stats" class="modal">\n            <div class="modal-dialog" role="document">\n                \x3c!-- Modal content --\x3e\n                <div class="modal-content">\n        \n                    <div class="modal-header">\n                        <h5 class="modal-title" id="ModalLabel">').concat(e("Layout Stats"),'</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n        \n                    <div id="stats-body" class="modal-body">\n        \n        \n                    </div>\n                </div>\n            </div>\n        </div>\n\n\n        <div class="modal" tabindex="-1">\n            <div class="modal-dialog">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title"></h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body">\n\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-primary btn-modal"></button>\n                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="toast-cont position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        </div>\n        \n    '))}};Y.init()}();
