!function(){"use strict";const t=(t,...e)=>{if(0===(t=String(t)).length)return"";return((t,e,...n)=>{let a=(t,e)=>(e.forEach(((e,n)=>{t=t.replace("%"+(n+1)+"$",e)})),t);return void 0===window.i18n||void 0===window.i18n.state.locale.values[t]?a(t,n):a(e(window.i18n.state.locale.values[t]),n)})(t,(t=>t.replace(/[&<>'"]/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"}[t])))),...e)},e=()=>{let t=document.querySelector(".loader");t&&(t.style.display="block")},n=t=>{let e=new URLSearchParams(window.location.search),n=e.get("sid")?e.get("sid"):"",a=-1==t.indexOf("?")?"?sid="+n:"&sid="+n;return t+a},a=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},o=()=>{let t=new URLSearchParams(window.location.search);return t.get("sid")?t.get("sid"):""},l=t=>{let e=t+"=",n=decodeURIComponent(document.cookie).split(";");for(let t=0;t<n.length;t++){let a=n[t];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""},r=()=>{let t=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,e=window.location.hostname+"/"+o()+"/"+l("locale");return e!=l("check")&&(t=0,console.log("refresh")),((t,e,n)=>{let a="";if(n){let t=new Date;t.setTime(t.getTime()+24*n*60*60*1e3),a=";expires="+t.toUTCString()}document.cookie=t+"="+(escape(e)||"")+a+";path=/;domain=.kenzap.cloud"})("check",e,5),t},i=()=>({Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+l("kenzap_api_key"),"Kenzap-Locale":l("locale")?l("locale"):"en","Kenzap-Header":r(),"Kenzap-Token":l("kenzap_token"),"Kenzap-Sid":o()});l("kenzap_api_key"),l("locale")&&l("locale"),r(),l("kenzap_token"),o();const c=t=>{if(console.log(t),isNaN(t.code)){let e=t;try{e=JSON.stringify(e)}catch(t){}let n=new URLSearchParams;return n.append("cmd","report"),n.append("sid",o()),n.append("token",l("kenzap_token")),n.append("data",e),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:n}),void alert("Can not connect to Kenzap Cloud")}if(401===t.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(t.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(t.reason)},d=(t,e)=>{if(document.querySelector(t))for(let n of document.querySelectorAll(t))n.removeEventListener("click",e,!0),n.addEventListener("click",e,!0)};var s={state:{firstLoad:!0,ajaxQueue:0},init:function(){s.getData()},getData:function(){s.state.firstLoad&&e(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:{Accept:"application/json","Content-Type":"text/plain",Authorization:"Bearer "+l("kenzap_api_key"),"Kenzap-Header":localStorage.hasOwnProperty("header"),"Kenzap-Token":l("kenzap_token"),"Kenzap-Sid":a()},body:JSON.stringify({query:{locale:{type:"locale",id:l("lang")},layouts:{type:"find",fields:"*",key:"myticket-layout",sid:o()}}})}).then((function(t){return t.json()})).then((function(e){var n;s.state.response=e,e.success?((t=>{if(t.header&&localStorage.setItem("header",t.header),!document.querySelector("#k-script")){let t=document.createElement("div");t.innerHTML=localStorage.getItem("header"),t=t.firstChild,document.body.prepend(t),Function(document.querySelector("#k-script").innerHTML).call("test")}t.locale&&window.i18n.init(t.locale)})(e),s.loadHomeStructure(),s.renderPage(),s.initListeners(),n=t("MyTicket 2.0.8 by %1$Kenzap%2$. ❤️ Licensed %3$GPLv3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/ecommerce" target="_blank">',"</a>"),document.querySelector("footer .row").innerHTML='\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">'.concat(n,'</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">').concat("","</span>\n    </div>"),s.state.firstLoad=!1):c(e)})).catch((function(t){console.error("Error:",t)}))},renderPage:function(){var e=document;(t=>{let e='<ol class="breadcrumb mt-2 mb-0">';for(let n of t)void 0===n.link?e+=`<li class="breadcrumb-item">${n.text}</li>`:e+=`<li class="breadcrumb-item"><a href="${n.link}">${n.text}</a></li>`;e+="</ol>",document.querySelector(".bc").innerHTML=e})([{link:n("https://dashboard.kenzap.cloud?launcher=myticket"),text:t("Home")},{link:n("/"),text:t("MyTicket")},{text:t("Layouts")}]);var a="";console.log(s.state.response.layouts),s.state.response.layouts.forEach((function(e,o){a+="\n            <tr>\n                <td>".concat(parseInt(o)+1,'</td>\n                <td><a href="').concat(n("/layout-edit/?id="+e._id),'">').concat(e.title,"</a></td>\n                <td>").concat(e.stats?e.stats.totalZones:0,"</td>\n                <td>").concat(e.stats?e.stats.totalSeats:0,'</td>\n                <td style="text-align:right;" class="">\n                    <button class="btn btn-sm dropdown-toggle" type="button" id="dropdownMenuSizeButton').concat(o,'" data-i="').concat(o,'" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">').concat(t("Option"),'</button>\n                    <div class="dropdown-menu" aria-labelledby="dropdownMenuSizeButton').concat(o,'" >\n                        <a class="dropdown-item edit-layout" href="').concat(n("/layout-edit/?id="+e._id),'" target="_self" >').concat(t("Edit"),'</a>\n                        <a class="dropdown-item duplicate-layout d-none" href="#" data-toggle="modal" data-_id="').concat(e._id,'" data-id="').concat(e._id,'" >').concat(t("Duplicate"),'</a>\n                        <a class="dropdown-item rename-layout" href="#" data-toggle="modal" data-_id="').concat(e._id,'" data-id="').concat(e._id,'" data-title="').concat(e.title,'">').concat(t("Rename"),'</a>\n                        <div class="dropdown-divider"></div>\n                        <a class="dropdown-item remove-layout" href="#" data-toggle="modal" data-_id="').concat(e._id,'" data-id="').concat(e._id,'" >').concat(t("Remove"),"</a>\n                    </div>\n                </td>\n            </tr>")})),s.state.response.layouts.length?e.querySelector(".layout_list").innerHTML=a:e.querySelector(".layout_list").innerHTML="<tr><td>".concat(t("No layouts to display yet"),"</td><td></td><td></td><td></td><td></td></tr>"),(()=>{let t=document.querySelector(".loader");t&&(t.style.display="none")})()},initListeners:function(){console.log("initListeners "),d(".rename-layout",s.listeners.renameLayout),d(".duplicate-layout",s.listeners.duplicateLayout),d(".remove-layout",s.listeners.removeLayout),s.state.firstLoad&&(d(".btn-add",s.listeners.addLayout),d(".btn-modal",s.listeners.modalSuccessBtn))},listeners:{addLayout:function(n){n.preventDefault();var a=document.querySelector(".modal"),l=new bootstrap.Modal(a);a.querySelector(".modal-title").innerHTML=t("Add Layout"),a.querySelector(".btn-primary").innerHTML=t("Add"),a.querySelector(".btn-secondary").innerHTML=t("Cancel"),n.currentTarget.dataset.id;var r,d='\n            <div class="form-cont">\n                <div class="form-group mb-3">\n                    <label for="p-title" class="form-label">'.concat(t("Title"),'</label>\n                    <input type="text" class="form-control" id="p-title" autocomplete="off" placeholder="').concat(t("Arena.."),'" value="').concat((r="",0===(r=String(r)).length?"":r.replace(/[&<>'"]/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"}[t])))),'">\n                    <ol class="mt-3 form-text">\n                        <li>').concat(t("Enter layout title"),"</li>\n                        <li>").concat(t("Click add button"),"</li>\n                        <li>").concat(t("Start creating layout"),'</li>\n                    </ol>\n                </div>\n                <p class="mt-2 form-text fs-8">').concat(t("Need help in designing your hall or stadium? %1$View examples%2$.",'<a target="_blank" href="https://kenzap.com/seat-reservation-in-wordpress-setup-service-1014779/">',"</a>"),"</p>\n            </div>");a.querySelector(".modal-body").innerHTML=d,s.listeners.modalSuccessBtnFunc=function(n){n.preventDefault();var r={};r.title=a.querySelector("#p-title").value,r.title.length<4?alert(t("Please provide longer title")):(e(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:i(),body:JSON.stringify({query:{layout:{type:"create",key:"myticket-layout",sid:o(),data:{title:r.title,stats:{totalZones:0,totalSeats:0},extra:{},img:""}}}})}).then((function(t){return t.json()})).then((function(t){t.success?(l.hide(),s.getData()):c(t)})).catch((function(t){c(t)})))},l.show(),setTimeout((function(){return a.querySelector("#p-title").focus()}),100)},duplicateLayout:function(n){if(n.preventDefault(),confirm(t("Duplicate this layout?"))){var o=n.currentTarget.dataset.id;n.preventDefault();var r=new URLSearchParams;r.append("cmd","duplicate_layout"),r.append("id",o),e(),fetch("https://api.kenzap.com/myticket/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded",Authorization:"Bearer "+l("kenzap_api_key"),"Kenzap-Header":localStorage.hasOwnProperty("header"),"Kenzap-Token":l("kenzap_token"),"Kenzap-Sid":a()},body:r}).then((function(t){return t.json()})).then((function(t){t.success?s.getData():c(t)})).catch((function(t){console.error("Error:",t)}))}},removeLayout:function(n){if(n.preventDefault(),confirm(t("Permanently remove this layout?"))){var a=n.currentTarget.dataset.id;n.preventDefault(),e(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:i(),body:JSON.stringify({query:{event:{type:"delete",key:"myticket-layout",id:a,sid:o()}}})}).then((function(t){return t.json()})).then((function(t){t.success?s.getData():c(t)})).catch((function(t){c(t)}))}},renameLayout:function(n){n.preventDefault();var a=document.querySelector(".modal"),l=new bootstrap.Modal(a);a.querySelector(".modal-title").innerHTML=t("Rename Layout"),a.querySelector(".btn-primary").innerHTML=t("Rename"),a.querySelector(".btn-secondary").innerHTML=t("Cancel");var r=n.currentTarget.dataset.id,d=n.currentTarget.dataset.title,u='\n            <div class="form-cont">                <div class="form-group mb-3">                    <label for="p-title" class="form-label">'.concat(t("Title"),'</label>                    <input type="text" class="form-control" id="p-title" autocomplete="off" placeholder="" value="').concat(d,'">                </div>            </div>');a.querySelector(".modal-body").innerHTML=u,s.listeners.modalSuccessBtnFunc=function(n){n.preventDefault();var d={};d.title=a.querySelector("#p-title").value,d.title.length<4?alert(t("Please provide longer title")):(e(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:i(),body:JSON.stringify({query:{event:{type:"update",key:"myticket-layout",id:r,sid:o(),data:{title:d.title}}}})}).then((function(t){return t.json()})).then((function(t){t.success?(l.hide(),s.getData()):c(t)})).catch((function(t){c(t)})))},l.show(),setTimeout((function(){return a.querySelector("#p-title").focus()}),100)},modalSuccessBtn:function(t){s.listeners.modalSuccessBtnFunc(t)},modalSuccessBtnFunc:null},loadHomeStructure:function(){s.state.firstLoad&&(document.querySelector("#contents").innerHTML='\n        <div class="container p-edit">\n            <div class="d-flex justify-content-between bd-highlight mb-3">\n                <nav class="bc" aria-label="breadcrumb"></nav>\n                <button class="btn btn-primary btn-add" type="button">'.concat(t("Add layout"),'</button>\n            </div>\n            <div class="row">\n\n                <div class="col-lg-12 grid-margin stretch-card">\n                    <div class="card border-white shadow-sm">\n                        <div class="card-body">\n                        <h4 class="card-title">').concat(t("Layout List"),'</h4>\n                        <p class="form-text">\n                            ').concat(t("Click on <code>option &gt; edit</code> to set up layout."),"\n                            ").concat(t("Can not find your old layout? Switch to %1$legacy mode%2$.",'<a href="'+n("/layout-list-legacy/")+'">',"</a>"),'\n                        </p>\n                        <div class="table-responsive">\n                            <table class="table table-hover table-borderless align-middle table-striped table-p-list" style="min-width: 800px;">\n                                <thead>\n                                    <tr>\n                                    <th>').concat(t("ID"),"</th>\n                                    <th>").concat(t("Title"),"</th>\n                                    <th>").concat(t("Zones"),"</th>\n                                    <th>").concat(t("Seats"),'</th>\n                                    <th style="text-align:right;"></th>\n                                    </tr>\n                                </thead>\n                                <tbody class="layout_list">\n                                    <tr>\n                                    <td></td><td></td><td></td><td></td><td></td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n\n        <div class="modal" tabindex="-1">\n            <div class="modal-dialog">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title"></h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body">\n\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-primary btn-modal"></button>\n                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n            <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive"\n                aria-atomic="true" data-bs-delay="3000">\n                <div class="d-flex">\n                    <div class="toast-body"></div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"\n                        aria-label="Close"></button>\n                </div>\n            </div>\n        </div>\n        \n    '))}};s.init()}();
